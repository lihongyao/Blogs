https://blog.csdn.net/jackson_mseven/category_12528926.html

https://mp.weixin.qq.com/s/x_oTytXbYLsj5bheUrulHQ

# å‰è¨€

[Next.js](https://nextjs.org/) æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºå…¨æ ˆ Web åº”ç”¨ç¨‹åºçš„ React æ¡†æ¶ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ React Components æ¥æ„å»ºç”¨æˆ·ç•Œé¢ï¼Œå¹¶ä½¿ç”¨ Next.js æ¥å®ç°é™„åŠ åŠŸèƒ½å’Œä¼˜åŒ–ã€‚

æœ¬æ–‡ä¸»è¦æ˜¯åœ¨å­¦ä¹  nextjs ä¸­çš„ç¬”è®°ï¼Œä»…ä¾›å‚è€ƒâ—ï¸

> æ¸©é¦¨æç¤ºï¼š
>
> 1. å»ºè®®å®‰è£…è°·æ­Œæ‰©å±• [Trancy](https://chromewebstore.google.com/detail/ai-%E5%8F%8C%E8%AF%AD%E5%AD%97%E5%B9%95%E7%BD%91%E9%A1%B5%E6%B2%89%E6%B5%B8%E7%BF%BB%E8%AF%91-%E2%80%94-trancy-%E8%AF%AD%E8%A8%80/mjdbhokoopacimoekfgkcoogikbfgngb?hl=zh-CN&utm_source=ext_sidebar)ï¼Œå¼€å¯ æ²‰æµ¸å¼ç¿»è¯‘ï¼Œæœ‰åŠ©äºé˜…è¯»å®˜æ–¹æ–‡æ¡£ã€‚
> 2. VSCode æ¨èå®‰è£…æ’ä»¶ï¼š[Nextjs snippets](https://marketplace.visualstudio.com/items?itemName=PulkitGangwar.nextjs-snippets) / [Tailwind CSS IntelliSense](https://marketplace.visualstudio.com/items?itemName=bradlc.vscode-tailwindcss)ã€‚
> 3. æ‚¨å¯ä»¥ç›´æ¥è‘± [Next.js å¿«é€ŸæŒ‡å—](https://nextjs.org/learn/dashboard-app) å¼€å§‹äº†è§£åŸºç¡€ç”¨æ³•ã€‚
> 4. å›¾æ ‡åº“ï¼š[heroicons](https://heroicons.com/)
> 5. ç»„ä»¶åº“ï¼š[tailwind ui](https://tailwindui.com/components)

# å‡†å¤‡å·¥ä½œ

ç³»ç»Ÿè¦æ±‚ï¼š

1. Node.js 18.18+
2. æ”¯æŒ macOSã€Windowsï¼ˆåŒ…æ‹¬ WSLï¼‰å’Œ Linuxã€‚

æœ¬æ–‡ç¯å¢ƒï¼š

- nodejsï¼š<mark>v22.11.0</mark>

- pnpmï¼š<mark>v9.12.3</mark>

> åœ¨ä½¿ç”¨ pnpm å®‰è£…ä¾èµ–æ—¶ï¼Œå¯é…ç½®é•œåƒï¼Œåœ¨æ ¹ç›®å½•åˆ›å»º .npmrc æ–‡ä»¶ï¼ŒæŒ‡å®šé•œåƒæºå³å¯ï¼š
>
> ```
> registry=http://registry.npmmirror.com
> ```

## åˆ›å»ºé¡¹ç›®

å»ºè®®ä½¿ç”¨ create-next-app å¯åŠ¨ä¸€ä¸ªæ–°çš„ Next.js åº”ç”¨ç¨‹åºï¼š

```shell
$ npx create-next-app@latest --use-pnpm
âœ” What is your project named? â€¦ hello-nextjs
âœ” Would you like to use TypeScript? â€¦ No / Yes
âœ” Would you like to use ESLint? â€¦ No / Yes
âœ” Would you like to use Tailwind CSS? â€¦ No / Yes
âœ” Would you like your code inside a `src/` directory? â€¦ No / Yes
âœ” Would you like to use App Router? (recommended) â€¦ No / Yes
âœ” Would you like to use Turbopack for next dev? â€¦ No / Yes
âœ” Would you like to customize the import alias (@/* by default)? â€¦ No / Yes
```

> æ¸©é¦¨æç¤ºï¼šè¾“å…¥é¡¹ç›®åç§°ä¹‹åï¼Œä¸€è·¯å›è½¦ï¼ˆâ†©ï¸ï¼‰å³å¯ï¼Œè¿™é‡Œå°†é¡¹ç›®å‘½åä¸º `hello-nextjs`

è¿›å…¥é¡¹ç›®ç›®å½•å¹¶å¯åŠ¨é¡¹ç›®ï¼š

```shell
$ code ./hello-nextjs
$ pnpm dev
```

> æ¸©é¦¨æç¤ºï¼šå¦‚æœæ§åˆ¶å°æç¤º *â€œA tree hydrated but some attributes of the server rendered HTML didn't match the client properties. This won't be patched up. This can happen if a SSR-ed Client Component used...â€* ï¼Œä¸å¿…ç†ä¼šï¼Œè¿™æ˜¯å› ä¸ºå¯ç”¨äº† **`Trancy`** æ‰©å±•å¯¼è‡´çš„ã€‚

## é¡¹ç›®ç»“æ„å’Œç»„ç»‡

@See https://nextjs.org/docs/app/getting-started/project-structure

```
.
â”œâ”€â”€ .next    
â”œâ”€â”€ node_modules           
â”œâ”€â”€ public/                    # é™æ€æ–‡ä»¶ï¼Œå¦‚å›¾ç‰‡ã€å­—ä½“ã€å›¾æ ‡ç­‰
â”‚   â”œâ”€â”€ images/                # å›¾ç‰‡èµ„æº
â”‚   â”œâ”€â”€ fonts/                 # å­—ä½“èµ„æº
â”‚   â”œâ”€â”€ favicon.ico            # ç½‘ç«™å›¾æ ‡
â”œâ”€â”€ src/                       # é¡¹ç›®ä¸»ç›®å½•
â”‚   â”œâ”€â”€ app/                   # ä½¿ç”¨ App Router çš„é¡µé¢ç»“æ„ (Next.js 13+)
â”‚   â”‚   â”œâ”€â”€ (group)/           # è·¯ç”±åˆ†ç»„(å¯é€‰)
â”‚   â”‚   â”œâ”€â”€ api/               # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/          # è®¤è¯ç›¸å…³ API
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts   # API å…¥å£æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ dashboard/         # ä»ªè¡¨ç›˜é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx       # é»˜è®¤å…¥å£é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx     # é’ˆå¯¹è¯¥è·¯ç”±çš„å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ about/             # å…³äºé¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ components/            # ä¸šåŠ¡ç»„ä»¶
â”‚   â”œâ”€â”€ ui/                    # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ hooks/                 # è‡ªå®šä¹‰ Hook
â”‚   â”œâ”€â”€ lib/                   # åŒ…å«åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çš„å‡½æ•°ï¼Œä¾‹å¦‚å¯é‡ç”¨çš„å®ç”¨å‡½æ•°å’Œæ•°æ®è·å–å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ api.ts             # API è¯·æ±‚å°è£…
â”‚   â”‚   â”œâ”€â”€ constants.ts       # å¸¸é‡
â”‚   â”‚   â””â”€â”€ utils.ts           # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ styles/                # å…¨å±€æ ·å¼æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ globals.css        # å…¨å±€æ ·å¼
â”‚   â”‚   â”œâ”€â”€ theme.css          # ä¸»é¢˜æ ·å¼
â”‚   â”œâ”€â”€ middleware.ts          # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ providers/             # å…¨å±€ Providerï¼ˆå¦‚ Context API æˆ– Redux Providerï¼‰
â”œâ”€â”€ .eslintrc.json
â”œâ”€â”€ .gitignore                 # è¦å¿½ç•¥çš„ Git æ–‡ä»¶å’Œæ–‡ä»¶å¤¹
â”œâ”€â”€ next-env.d.ts              # Next.js çš„ TypeScript å£°æ˜æ–‡ä»¶
â”œâ”€â”€ next.config.ts             # Next.js çš„é…ç½®æ–‡ä»¶
â”œâ”€â”€ package.json               # é¡¹ç›®ä¾èµ–å’Œè„šæœ¬
â”œâ”€â”€ postcss.config.mjs         # PostCSS çš„é…ç½®æ–‡ä»¶
â”œâ”€â”€ tailwind.config.ts         # TailwindCSS çš„é…ç½®æ–‡ä»¶
â””â”€â”€ tsconfig.json              # TypeScript çš„é…ç½®æ–‡ä»¶
```

> æ¸©é¦¨æç¤ºï¼šå»ºè®®ä»”ç»†é˜…è¯»è¯¥ç« èŠ‚ï¼Œç†Ÿæ‚‰ Next.js ä¸­çš„æ–‡ä»¶å¤¹å’Œæ–‡ä»¶çº¦å®šä»¥åŠç»„ç»‡é¡¹ç›®çš„æç¤ºã€‚

# è·¯ç”±

@See https://nextjs.org/docs/app/building-your-application/routing

> æ¸©é¦¨æç¤ºï¼šæœ¬ç¤ºä¾‹ä¸»è¦ä½¿ç”¨ APP Router

## å®šä¹‰è·¯ç”±

Next.js åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„è·¯ç”±å™¨ï¼Œå³ä½¿ç”¨æ–‡ä»¶å¤¹æ¥å®šä¹‰è·¯ç”±ã€‚æ¯ä¸ªæ–‡ä»¶å¤¹ä»£è¡¨ä¸€ä¸ªæ˜ å°„åˆ° URL æ®µçš„è·¯ç”±æ®µã€‚è¦åˆ›å»ºåµŒå¥—è·¯ç”±ï¼Œæ‚¨å¯ä»¥å°†æ–‡ä»¶å¤¹ç›¸äº’åµŒå¥—ã€‚ `page.tsx` æ–‡ä»¶ç”¨äºä½¿è·¯ç”±æ®µå¯å…¬å¼€è®¿é—®ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š

1. éœ€è¦ page.js æ–‡ä»¶æ‰èƒ½å…¬å¼€è®¿é—®è·¯çº¿æ®µã€‚
2. é»˜è®¤æƒ…å†µä¸‹ï¼Œé¡µé¢æ˜¯æœåŠ¡ç«¯ç»„ä»¶ï¼Œä½†å¯ä»¥è®¾ç½®ä¸ºå®¢æˆ·ç«¯ç»„ä»¶ï¼Œæ–‡ä»¶é¡¶éƒ¨è®¾ç½® `use client`ã€‚
3. é¡µé¢å¯ä»¥è·å–æ•°æ®ã€‚
4. é¡µé¢å§‹ç»ˆæ˜¯è·¯ç”±å­æ ‘çš„å¶å­ã€‚

## å¸ƒå±€å’Œæ¨¡æ¿

@See https://nextjs.org/docs/app/building-your-application/routing/layouts-and-templates

`layout.js` å’Œ `template.js` å…è®¸æ‚¨åˆ›å»ºåœ¨è·¯ç”±ä¹‹é—´å…±äº«çš„UIã€‚

1. å¸ƒå±€æ˜¯åœ¨å¤šä¸ªè·¯ç”±ä¹‹é—´å…±äº«çš„ UIã€‚åœ¨å¯¼èˆªæ—¶ï¼Œå¸ƒå±€ä¿ç•™çŠ¶æ€ã€ä¿æŒäº¤äº’æ€§å¹¶ä¸”ä¸é‡æ–°æ¸²æŸ“ã€‚å¸ƒå±€ä¹Ÿå¯ä»¥åµŒå¥—ã€‚
2. æ¨¡æ¿ä¸å¸ƒå±€ç±»ä¼¼ï¼Œå®ƒä»¬åŒ…è£…å­å¸ƒå±€æˆ–é¡µé¢ã€‚ä¸è·¨è·¯çº¿æŒç»­å­˜åœ¨å¹¶ç»´æŠ¤çŠ¶æ€çš„å¸ƒå±€ä¸åŒï¼Œæ¨¡æ¿ä¸ºå¯¼èˆªä¸Šçš„æ¯ä¸ªå­çº§åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹ã€‚è¿™æ„å‘³ç€å½“ç”¨æˆ·åœ¨å…±äº«æ¨¡æ¿çš„è·¯ç”±ä¹‹é—´å¯¼èˆªæ—¶ï¼Œä¼šå®‰è£…å­çº§çš„æ–°å®ä¾‹ï¼Œé‡æ–°åˆ›å»º DOM å…ƒç´ ï¼Œå®¢æˆ·ç«¯ç»„ä»¶ä¸­ä¸ä¼šä¿ç•™çŠ¶æ€ï¼Œå¹¶ä¸”ä¼šé‡æ–°åŒæ­¥æ•ˆæœã€‚

## é“¾æ¥å’Œå¯¼èˆª

@See https://nextjs.org/docs/app/building-your-application/routing/linking-and-navigating

Next.js æœ‰å››ç§åœ¨è·¯ç”±ä¹‹é—´å¯¼èˆªçš„æ–¹æ³•ï¼š

1. ä½¿ç”¨ [\<Link>](https://nextjs.org/docs/app/building-your-application/routing/linking-and-navigating#link-component) ç»„ä»¶
2. ä½¿ç”¨ [useRouter()](https://nextjs.org/docs/app/building-your-application/routing/linking-and-navigating#userouter-hook) é’©å­å‡½æ•° â€”â€” å®¢æˆ·ç«¯ç»„ä»¶
3. ä½¿ç”¨ [redirect](https://nextjs.org/docs/app/building-your-application/routing/linking-and-navigating#userouter-hook) å‡½æ•° â€”â€” æœåŠ¡ç«¯ç»„ä»¶
4. ä½¿ç”¨ [History API](https://nextjs.org/docs/app/building-your-application/routing/linking-and-navigating#using-the-native-history-api)

## é”™è¯¯å¤„ç†

@See https://nextjs.org/docs/app/building-your-application/routing/error-handling

é”™è¯¯å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šé¢„æœŸçš„é”™è¯¯å’Œæœªæ•è·çš„å¼‚å¸¸ï¼š

1. **é¢„æœŸçš„é”™è¯¯é€šè¿‡è¿”å›å€¼å¤„ç†**ï¼šå¯¹äºæœåŠ¡å™¨ç«¯çš„æ“ä½œï¼ˆServer Actionsï¼‰ï¼Œé¿å…ä½¿ç”¨ try/catch æ¥å¤„ç†é¢„æœŸä¼šå‘ç”Ÿçš„é”™è¯¯ï¼Œè€Œæ˜¯é€šè¿‡ useActionState æ¥ç®¡ç†è¿™äº›é”™è¯¯ï¼Œå¹¶å°†é”™è¯¯ä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯ã€‚
2. **æœªé¢„æœŸçš„å¼‚å¸¸ç”¨é”™è¯¯è¾¹ç•Œå¤„ç†**ï¼šå¯¹äºæœªé¢„æœŸçš„å¼‚å¸¸ï¼Œä½¿ç”¨é”™è¯¯è¾¹ç•Œï¼ˆError Boundariesï¼‰æ¥å¤„ç†ã€‚å¯ä»¥é€šè¿‡ error.tsx å’Œ global-error.tsx æ–‡ä»¶æ¥å®ç°é”™è¯¯è¾¹ç•Œï¼Œå¹¶æä¾›å¤‡ç”¨çš„ç•Œé¢æ˜¾ç¤ºï¼ˆFallback UIï¼‰ã€‚

### å¤„ç†é¢„æœŸé”™è¯¯

@See https://nextjs.org/docs/app/building-your-application/routing/error-handling#handling-expected-errors

é¢„æœŸçš„é”™è¯¯æ˜¯æŒ‡åœ¨åº”ç”¨ç¨‹åºæ­£å¸¸è¿è¡Œä¸­å¯èƒ½å‘ç”Ÿçš„é”™è¯¯ï¼Œä¾‹å¦‚æœåŠ¡å™¨ç«¯è¡¨å•éªŒè¯å¤±è´¥æˆ–è¯·æ±‚å¤±è´¥ã€‚è¿™ç±»é”™è¯¯åº”è¯¥è¢«æ˜ç¡®å¤„ç†ï¼Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

#### å¤„ç†æœåŠ¡ç«¯æ“ä½œä¸­çš„é¢„æœŸé”™è¯¯

ä½¿ç”¨ useActionState é’©å­ç®¡ç†æœåŠ¡å™¨ç«¯æ“ä½œï¼ˆServer Actionsï¼‰çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬é”™è¯¯å¤„ç†ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥é¿å…ä½¿ç”¨ try/catch å—æ¥å¤„ç†é¢„æœŸçš„é”™è¯¯ã€‚è¿™äº›é”™è¯¯åº”è¢«è®¾è®¡ä¸ºè¿”å›å€¼ï¼Œè€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸ã€‚

![](./imgs/nextjs_server_error.jpg)

ç‰¹åˆ«æ˜¯åœ¨è¡¨å•æ“ä½œå½“ä¸­ï¼Œå‡è®¾è¾“å…¥è´¦å·æˆ–å¯†ç é”™è¯¯ï¼Œåº”è¯¥ç»™å‡ºç›¸åº”çš„æç¤ºä¿¡æ¯ï¼Œè€Œä¸æ˜¯ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè§¦å‘é”™è¯¯è¾¹ç•Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```tsx
"use server";

import { revalidatePath } from "next/cache";
import { redirect } from "next/navigation";


export type State = {
  usernameErrorMsg?: string;
  passwordErrorMsg?: string;
}

export async function login(prevState: State, formData: FormData) {

  const username = formData.get('username')?.toString() || '';
  const password = formData.get('password')?.toString() || '';

  if (!/^1[3-9]\d{9}$/.test(username)) return { usernameErrorMsg: 'æ‰‹æœºå·æ ¼å¼é”™è¯¯' }
  if (username !== '15888888888') return { usernameErrorMsg: 'æ‰‹æœºå·ä¸å­˜åœ¨' }
  if (password !== '1234') return { passwordErrorMsg: 'å¯†ç é”™è¯¯' }
  await new Promise((resolve) => setTimeout(resolve, 3000));

  revalidatePath('/dashboard');
  redirect('/dashboard');

}
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ“ä½œä¼ é€’ç»™ `useActionState` é’©å­å¹¶ä½¿ç”¨è¿”å›çš„çŠ¶æ€æ¥æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ã€‚

```tsx
"use client";

import React, { useActionState } from "react";
import { login, State } from "@/actions";

export default function Login() {
  const initialState: State = { usernameErrorMsg: "", passwordErrorMsg: "" };
  const [state, formAction, isPending] = useActionState(login, initialState);
  return (
    <div className="h-lvh w-lvw flex justify-center items-center">
      <div className="px-10 py-6 bg-gray-100 rounded-md">
        <h1 className="text-blue-500 mb-4 text-2xl">ç™»å½•</h1>
        <form action={formAction} className="space-y-4">
          {/* è´¦å· */}
          <div>
            <div>
              <label htmlFor="username">è´¦å·ï¼š</label>
              <input 
                type="tel" 
                id="username" 
                name="username" 
                placeholder="ç™»å½•è´¦å·ï¼ˆæ‰‹æœºå·ï¼‰" 
                className="p-1" 
                required 
                maxLength={11} 
              />
            </div>
            <p className="text-red-500 mt-1" aria-live="polite">
              {state?.usernameErrorMsg}
            </p>
          </div>
          {/* å¯†ç  */}
          <div>
            <div>
              <label htmlFor="password">å¯†ç ï¼š</label>
              <input 
                type="password" 
                id="password" 
                name="password" 
                placeholder="ç™»å½•å¯†ç " 
                className="p-1" 
                required 
                maxLength={20} 
              />
            </div>
            <p className="text-red-500" aria-live="polite">
              {state?.passwordErrorMsg}
            </p>
          </div>
          {/* ç™»å½•æŒ‰é’® */}
          <button type="submit" className="w-full h-10 bg-blue-500 text-white rounded-md mt-20">
            {isPending ? "ç™»å½•ä¸­..." : "ç™»å½•"}
          </button>
        </form>
      </div>
    </div>
  );
}
```

![](./imgs/nextjs_server_error_toast.jpg)

> æ¸©é¦¨æç¤ºï¼šä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è¿”å›çš„çŠ¶æ€åœ¨å®¢æˆ·ç«¯æ˜¾ç¤º toast æç¤ºã€‚

#### å¤„ç†æœåŠ¡å™¨ç»„ä»¶çš„é¢„æœŸé”™è¯¯

åœ¨æœåŠ¡å™¨ç»„ä»¶å†…éƒ¨è·å–æ•°æ®æ—¶ï¼Œå¯ä»¥æ ¹æ®å“åº”æœ‰æ¡ä»¶åœ°å‘ˆç°é”™è¯¯æ¶ˆæ¯æˆ–é‡å®šå‘ã€‚

```tsx
export default async function Page() {
  const res = await fetch('https://...');
  const data = await res.json();
  if (!res.ok) {
    return "There was an error.";
  }

  return "...";
}

```

### æœªæ•è·çš„å¼‚å¸¸

@See https://nextjs.org/docs/app/building-your-application/routing/error-handling#uncaught-exceptions

æœªæ•è·çš„å¼‚å¸¸å±äºæ„å¤–é”™è¯¯ï¼Œè¡¨ç¤ºåœ¨åº”ç”¨ç¨‹åºæ­£å¸¸æµç¨‹ä¸­ä¸åº”å‘ç”Ÿçš„é”™è¯¯æˆ–é—®é¢˜ã€‚è¿™äº›åº”è¯¥é€šè¿‡æŠ›å‡ºé”™è¯¯æ¥å¤„ç†ï¼Œç„¶åé”™è¯¯è¾¹ç•Œä¼šæ•è·é”™è¯¯ã€‚

1. å¸¸è§å¤„ç†æ–¹å¼ï¼šä½¿ç”¨ error.tsx å¤„ç†æ ¹å¸ƒå±€ä¸‹æœªæ•è·çš„é”™è¯¯ï¼ˆé”™è¯¯è¾¹ç•Œï¼‰ã€‚
2. å¯é€‰å¤„ç†æ–¹å¼ï¼šä½¿ç”¨åµŒå¥—çš„ error.tsx æ–‡ä»¶ï¼ˆä¾‹å¦‚ app/dashboard/error.tsxï¼‰å¤„ç†ç»†ç²’åº¦çš„æœªæ•è·é”™è¯¯ã€‚
3. ä¸å¸¸è§çš„å¤„ç†æ–¹å¼ï¼š<del>ä½¿ç”¨ global-error.js å¤„ç†æ ¹å¸ƒå±€ä¸­æœªæ•è·çš„é”™è¯¯ï¼ˆå…¨å±€é”™è¯¯ï¼‰ã€‚</del>

#### é”™è¯¯è¾¹ç•Œ

@See https://nextjs.org/docs/app/building-your-application/routing/error-handling#using-error-boundaries

Next.js ä½¿ç”¨é”™è¯¯è¾¹ç•Œæ¥å¤„ç†æœªæ•è·çš„å¼‚å¸¸ã€‚é”™è¯¯è¾¹ç•Œæ•è·å­ç»„ä»¶ä¸­çš„é”™è¯¯å¹¶æ˜¾ç¤ºåå¤‡ UIï¼Œè€Œä¸æ˜¯å´©æºƒçš„ç»„ä»¶æ ‘ã€‚

## åŠ è½½UIå’Œæµå¼ä¼ è¾“

@See https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming

é€šè¿‡ loading.tsx å¯ä»¥ä½¿ç”¨ React Suspense åˆ›å»ºæœ‰æ„ä¹‰çš„åŠ è½½UIï¼ˆæ¯”å¦‚ éª¨æ¶å›¾ï¼‰ï¼ŒåŸºäºæ­¤ï¼Œå¯ä»¥åœ¨åŠ è½½è·¯ç”±å†…å®¹æ—¶æ˜¾ç¤ºæœåŠ¡å™¨çš„å³æ—¶åŠ è½½çŠ¶æ€ï¼Œæ¸²æŸ“å®Œæˆåï¼Œå°†è‡ªåŠ¨åˆ‡å…¥æ–°å†…å®¹ã€‚

![](./imgs/nextjs_loading_ui.avif)

ç°åœ¨ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿæ¸²æŸ“ä¸€ä¸ªåˆ—è¡¨ï¼š

```tsx
// app/page.tsx
import React from "react";
import mockjs from "mockjs";
import Image from "next/image";

async function fetchData() {
  // -- æ¨¡æ‹Ÿè€—æ—¶
  await new Promise((resolve) => setTimeout(resolve, 3 * 1000));
  // -- æ¨¡æ‹Ÿæ•°æ®
  return mockjs.mock({
    code: 200,
    message: "success",
    "data|5": [
      {
        "id|+1": 1,
        title: "@title",
        cover: "@Image('80x80','@color')",
        description: "@paragraph",
      },
    ],
  });
}

export default async function Page() {
  const res = await fetchData();
  return (
    <div className="container mx-auto p-8 space-y-4">
      {res.data.map((item: any) => (
        <div className="flex" key={item.id}>
          <div className="w-20 h-20 shrink-0 relative mr-4">
            <Image className="object-cover rounded-md" src={item.cover} fill alt="cover" sizes="80px" />
          </div>
          <div className="flex-1">
            <div className="text-gray-900 truncate">{item.title}</div>
            <div className="line-clamp-2 text-sm text-gray-400">{item.description}</div>
          </div>
        </div>
      ))}
    </div>
  );
}
```

ä»£ç ç‰‡æ®µä¸­ï¼Œæ¨¡æ‹Ÿè¯·æ±‚è€—æ—¶ 3sï¼Œå½“å¯¼èˆªåˆ°å½“å‰è·¯ç”±æ—¶ï¼Œé¡µé¢å°†ä¼šå‡ºç° 3s çš„ç©ºç™½ï¼Œç„¶åå†æ¸²æŸ“å¦‚ä¸‹å†…å®¹ï¼š

![](./imgs/nextjs_streaming_1.jpg)

ä¸¥æ ¼ä¸Šæ¥è¯´ï¼Œè¿™æ ·çš„äº¤äº’æ˜¯ä¸å¤ªå‹å¥½çš„ï¼Œæ­¤æ—¶æˆ‘ä»¬åº”è¯¥ä½¿ç”¨æµå¼ä¼ è¾“æ¥å®ç°å¤‡ç”¨ uiï¼Œé¦–å…ˆæˆ‘ä»¬åˆ›å»ºæ–‡ä»¶ï¼š`/app/ui/Skeletons.tsx`ï¼Œæ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼š

```tsx
const shimmer =
  "before:absolute before:inset-0 before:-translate-x-full before:animate-[shimmer_2s_infinite] before:bg-gradient-to-r before:from-transparent before:via-white/60 before:to-transparent";

export function HeroSkeleton() {
  return (
    <div className={`${shimmer} relative container mx-auto p-8 space-y-4`}>
      {Array.from({ length: 5 })
        .fill(0)
        .map((_, index) => (
          <div className="flex" key={index}>
            <div className="w-20 h-20 shrink-0 relative mr-4 bg-gray-200 rounded-md"></div>
            <div className="flex-1">
              <div className="h-6 bg-gray-200 rounded-md mb-2"></div>
              <div className="space-y-1">
                <div className="w-full h-4 bg-gray-200 rounded-md"></div>
                <div className="w-1/2 h-4 bg-gray-200 rounded-md"></div>
              </div>
            </div>
          </div>
        ))}
    </div>
  );
}
```

> æç¤ºï¼š
>
> 1. ä¸ºäº†ä½¿ tailwindscss æ ·å¼ç”Ÿæ•ˆï¼Œæˆ‘ä»¬éœ€åœ¨ `tailwind.config.ts`  é…ç½®æ–‡ä»¶ä¸­å°† `ui` ç›®å½•åŠ å…¥é…ç½®é¡¹ã€‚
>
>    ```tsx
>    {
>      "content": [
>        ...
>        "./src/ui/**/*.{js,ts,jsx,tsx,mdx}"
>        ...
>    	]
>    }
>    ```
>
> 2. ä»£ç ç‰‡æ®µä¸­å®šä¹‰äº† `shimmer` åŠ¨ç”»ï¼Œæ­¤æ—¶æˆ‘ä»¬è¿˜éœ€è¦åœ¨ `tailwind.config.ts` æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªå¸§åŠ¨ç”»é…ç½®
>
>    ```
>    import type { Config } from "tailwindcss";
>    export default {
>      ...
>      theme: {
>        // -- å®šä¹‰åŠ¨ç”»
>        keyframes: { shimmer: { '100%': { transform: 'translateX(100%)' } } },
>      },
>    } satisfies Config;
>    ```
>
> 3. ...

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨ `page.tsx` åŒçº§ç›®å½•é‡Œä¸­ï¼Œåˆ›å»º `loading.tsx`ï¼Œå¹¶å¡«å…¥å¦‚ä¸‹ä»£ç ï¼š

```tsx
import { HeroSkeleton } from "@/ui/Skeletons";
import React from "react";

export default function Loading() {
  return <HeroSkeleton />;
}
```

æ¸²æŸ“æ•ˆæœå¦‚ä¸‹ï¼š

![](./imgs/nextjs_streaming_2.gif)

æµå¼ä¼ è¾“å…è®¸ä½ å°†é¡µé¢çš„ HTML åˆ†è§£ä¸ºæ›´å°çš„å—ï¼Œå¹¶é€æ­¥å°†è¿™äº›å—ä»æœåŠ¡å™¨å‘é€åˆ°å®¢æˆ·ç«¯ã€‚

![](./imgs/nextjs_streaming_3.avif)

è¿™ä½¿å¾—é¡µé¢çš„æŸäº›éƒ¨åˆ†èƒ½å¤Ÿæ›´å¿«åœ°æ˜¾ç¤ºï¼Œè€Œæ— éœ€ç­‰å¾…æ‰€æœ‰æ•°æ®åŠ è½½åæ‰èƒ½å‘ˆç°ä»»ä½• UIã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å°†åˆšåˆšé¡µé¢ï¼ˆ`app/page.tsx`ï¼‰ä¸­çš„ä»£ç æå–åˆ° `ui/HeroList.tsx` ä¸­ï¼Œç„¶åä¿®æ”¹é¡µé¢ä»£ç å¦‚ä¸‹ï¼š

```tsx
import React from "react";
import HeroList from "@/ui/HeroList";

export default async function Page() {
  return <HeroList />;
}
```

å†æ¬¡åˆ·æ–°é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°ç›¸åŒçš„æ•ˆæœï¼Œè¿™ç§æ–¹å¼å¯ä»¥ä½¿å¾—æˆ‘ä»¬æ›´ç»†è…»è¯çš„å»æ§åˆ¶ç»„ä»¶çš„åŠ è½½ã€‚

## é‡å®šå‘

@See https://nextjs.org/docs/app/building-your-application/routing/redirecting

## è·¯ç”±ç»„

@See https://nextjs.org/docs/app/building-your-application/routing/route-groups

åœ¨æ–‡ä»¶å¤¹åç§°å‰åæ·»åŠ æ‹¬å·ï¼Œå¦‚ `(folderName)`ï¼Œå¯ä»¥åˆ›å»ºè·¯ç”±ç»„ã€‚è¿™ç§æ–¹å¼çš„ç‰¹ç‚¹æ˜¯ folderName æœ¬èº«ä¸ä¼šå‡ºç°åœ¨å®é™…çš„è·¯ç”±è·¯å¾„ä¸­ï¼Œä½†å¯ä»¥ç”¨æ¥ç»„ç»‡ä»£ç ï¼ŒæŒ‰ç…§åŠŸèƒ½æˆ–å›¢é˜Ÿè¿›è¡Œåˆ†ç»„ï¼Œä¾‹å¦‚ï¼š

```
.
â”œâ”€â”€ app
â”‚   â”œâ”€â”€ (shop)
â”‚   â”‚   â”œâ”€â”€ orders
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ shopping-cart
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ (user)
â”‚   â”‚   â”œâ”€â”€ innfos
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚	  â””â”€â”€	page.tsx
```

ä¸Šé¢ç¤ºä¾‹å°†é¡µé¢åˆ†ä¸ºä¸¤ä¸ªè·¯ç”±ç»„ `shop` å’Œ `user`ï¼Œè¿™æ ·ç»„ç»‡ä»£ç æ›´å…·å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ`shop` å’Œ `user` å¹¶ä¸å‚ä¸åˆ°è·¯ç”±ä¸­ï¼Œæ¯”å¦‚ï¼Œå½“ä½ æƒ³è®¿é—®è´­è½¦é¡µé¢æ—¶ï¼Œè·¯å¾„åº”è¯¥æ˜¯ï¼š`/shopping-cart`

è·¯ç”±ç»„é™¤äº†ç»„ç»‡ä»£ç ä¹‹å¤–ï¼Œå½“ä½ æƒ³ç»™ç‰¹å®šçš„è·¯ç”±è®¾ç½®å¸ƒå±€ï¼ˆ`layout.tsx`ï¼‰æˆ–è€…éª¨æ¶ï¼ˆ`loading.tsx`ï¼‰æ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è·¯ç”±ç»„æ¥å®ç°ï¼Œåªéœ€å°†ç‰¹å®šçš„è·¯ç”±æ”¾åœ¨åŒä¸€ä¸ªç»„ä¸‹ï¼Œç„¶åå®šä¹‰å¸ƒå±€æˆ–éª¨æ¶å³å¯ã€‚

## åŠ¨æ€è·¯ç”±

@See https://nextjs.org/docs/app/building-your-application/routing/dynamic-routes

å½“ä½ æ— æ³•æå‰ç¡®å®šè·¯ç”±æ®µåç§°ï¼Œå¹¶å¸Œæœ›æ ¹æ®åŠ¨æ€æ•°æ®ç”Ÿæˆè·¯ç”±æ—¶ï¼Œå¯ä»¥ä½¿ç”¨**åŠ¨æ€è·¯ç”±æ®µ**ã€‚è¿™äº›è·¯ç”±æ®µå¯ä»¥åœ¨è¯·æ±‚æ—¶åŠ¨æ€å¡«å……ï¼Œæˆ–è€…åœ¨æ„å»ºæ—¶é¢„æ¸²æŸ“ã€‚è¿™ç§æ–¹å¼éå¸¸é€‚åˆç”¨äºç”¨æˆ·è¯¦æƒ…é¡µã€æ–‡ç« è¯¦æƒ…é¡µç­‰è·¯å¾„ä¼šéšæ•°æ®å˜åŒ–çš„åœºæ™¯ã€‚

å¯ä»¥é€šè¿‡å°†æ–‡ä»¶å¤¹åç§°æ‹¬åœ¨æ–¹æ‹¬å·ä¸­æ¥åˆ›å»ºåŠ¨æ€åˆ†æ®µï¼š[folderName]ã€‚ä¾‹å¦‚ï¼Œ[id] æˆ– [slug]ã€‚

å‡è®¾ï¼Œç°åœ¨éœ€è¦åˆ›å»ºä¸€ä¸ªåšå®¢åˆ—è¡¨å’Œåšå®¢è¯¦æƒ…é¡µé¢ï¼Œä½ å¯ä»¥å®šä¹‰å¦‚ä¸‹ç›®å½•ç»“æ„ï¼š

```
.
â”œâ”€â”€ app
â”‚   â”œâ”€â”€ news
â”‚   â”‚   â”œâ”€â”€ [slug]
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx # åšå®¢è¯¦æƒ…é¡µ 
â”‚   â”‚   â””â”€â”€ page.tsx     # åšå®¢åˆ—è¡¨é¡µ
```

åœ¨ä¸Šè¿°ç»“æ„ä¸­ï¼š

- [slug] æ˜¯åŠ¨æ€è·¯ç”±æ®µï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„å‚æ•°ç”Ÿæˆè·¯å¾„ï¼Œæ¯”å¦‚ /1

- æ–‡ä»¶å¤¹åç§°ä¸­çš„slug ä¼šä½œä¸ºå‚æ•°ä¼ é€’ç»™é¡µé¢ç»„ä»¶ï¼Œä¾›ä½ è®¿é—®å’Œä½¿ç”¨ã€‚

åŠ¨æ€æ®µä½œä¸º params å±æ€§ä¼ é€’ç»™å¸ƒå±€ã€é¡µé¢ã€è·¯ç”±å’Œç”Ÿæˆå…ƒæ•°æ®å‡½æ•°ï¼š

```tsx
import React from "react";

export default async function Page({ params }: { params: Promise<{ slug: string }> }) {
  const slug = (await params).slug;
  return (
    <div className="p-8 text-center">
      <h1>This is blog details of slugï¼š{slug}</h1>
    </div>
  );
}
```

> åœ¨ Next.js ä¸­ï¼Œparams æ˜¯ä¸€ä¸ªå¼‚æ­¥å±æ€§ï¼Œå› æ­¤æ— æ³•ç›´æ¥ä½¿ç”¨å®ƒçš„å€¼ã€‚ä½ éœ€è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¹‹ä¸€æ¥è®¿é—®ï¼š
>
> - async/awaitï¼šé€‚ç”¨äºåœ¨å¼‚æ­¥ç»„ä»¶æˆ–å‡½æ•°ä¸­æ˜¾å¼ç­‰å¾…å‚æ•°è§£æçš„åœºæ™¯ï¼ˆæ¨èï¼‰ã€‚
> - React çš„ use é’©å­å‡½æ•° ï¼ˆä½¿ç”¨ use å‡½æ•°éœ€è¦ç¡®ä¿åœ¨ React 18 åŠä»¥ä¸Šç‰ˆæœ¬çš„ Server Components ä¸­ä½¿ç”¨ï¼‰ã€‚

## å¹¶è¡Œï¼ˆå¹³è¡Œï¼‰è·¯ç”±

@See https://nextjs.org/docs/app/building-your-application/routing/parallel-routes

Next.js ä¸­çš„ **å¹³è¡Œè·¯ç”±ï¼ˆParallel Routesï¼‰** æ˜¯ä¸€ç§ç”¨äºç®¡ç†é¡µé¢å†…å®¹çš„å¼ºå¤§è·¯ç”±æœºåˆ¶ï¼Œå°¤å…¶é€‚ç”¨äºæ„å»ºå¤æ‚çš„åµŒå¥—å¸ƒå±€å’Œå¤šè§†å›¾é¡µé¢ã€‚å®ƒå…è®¸åœ¨åŒä¸€é¡µé¢ä¸Šæ¸²æŸ“å¤šä¸ªè·¯ç”±èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥ç‹¬ç«‹åŠ è½½å’Œæ›´æ–°ï¼Œä»è€Œå®ç°æ›´åŠ çµæ´»çš„ç•Œé¢è®¾è®¡å’Œç”¨æˆ·ä½“éªŒã€‚

![](./imgs/nextjs_parallel_routes_1.gif)

é»˜è®¤æƒ…å†µä¸‹ï¼ŒNext.js è·Ÿè¸ªæ¯ä¸ªæ§½çš„æ´»åŠ¨çŠ¶æ€ï¼Œå—å¯¼èˆªç±»å‹çš„å½±å“ï¼ˆè½¯å¯¼èˆª/ç¡¬å¯¼èˆªï¼‰ï¼Œåœ¨å¹³è¡Œè·¯ç”±é¡µé¢åŠå…¶å­é¡µé¢åˆ·æ–°å°†ä¼šå‡ºç° 404 çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å®šä¹‰ `default.tsx` æ–‡ä»¶å¤„ç†ï¼ˆå‘ˆç°åå¤‡UIï¼‰ã€‚

## æ‹¦æˆªè·¯ç”±

@See https://nextjs.org/docs/app/building-your-application/routing/intercepting-routes

åœ¨ **Next.js** ä¸­ï¼Œ**æ‹¦æˆªè·¯ç”±ï¼ˆIntercepting Routesï¼‰** æ˜¯ä¸€ç§ç”¨äºåœ¨å¯¼èˆªæ—¶ä¸´æ—¶è¦†ç›–è·¯ç”±è¡Œä¸ºçš„æœºåˆ¶ã€‚å®ƒå…è®¸å¼€å‘è€…åœ¨ç”¨æˆ·è®¿é—®æŸä¸ªé¡µé¢æ—¶ï¼Œä¸ç›´æ¥å¯¼èˆªåˆ°è¯¥é¡µé¢ï¼Œè€Œæ˜¯ä»¥æ¨¡æ€çª—å£ï¼ˆmodalï¼‰ã€ä¾§è¾¹æ æˆ–åµŒå¥—è§†å›¾çš„æ–¹å¼å±•ç¤ºç›®æ ‡å†…å®¹ï¼ŒåŒæ—¶ä¿ç•™å½“å‰é¡µé¢çš„èƒŒæ™¯ã€‚ç”¨æˆ·å…³é—­æ¨¡æ€çª—å£æˆ–ä¾§è¾¹æ åï¼Œè·¯ç”±ä¼šæ¢å¤åˆ°åŸé¡µé¢çŠ¶æ€ã€‚

æ¯”å¦‚ï¼Œç°åœ¨æœ‰ä¸€ä¸ªäº§å“åˆ—è¡¨é¡µï¼Œç‚¹å‡»æŸä¸ªäº§å“æ—¶ä¼šå¼¹å‡ºæ¨¡æ€æ¡†å±•ç¤ºè¯¥äº§å“çš„è¯¦ç»†ä¿¡æ¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè·¯ç”±åœ°å€å¹¶æœªå‘ç”Ÿå˜åŒ–ã€‚å¦‚æœä½ å°†æ­¤é¡µé¢åˆ†äº«ç»™æœ‹å‹ï¼Œæœ‹å‹æ‰“å¼€é“¾æ¥æ—¶çœ‹åˆ°çš„ä¾ç„¶æ˜¯äº§å“åˆ—è¡¨é¡µï¼Œè€Œä¸æ˜¯ä½ æƒ³è¦åˆ†äº«çš„äº§å“è¯¦æƒ…é¡µã€‚é€šè¿‡æ‹¦æˆªè·¯ç”±ï¼Œå¯ä»¥åœ¨ç‚¹å‡»äº§å“æ—¶è·³è½¬åˆ°å¯¹åº”çš„è¯¦æƒ…é¡µï¼Œä½†åŒæ—¶é€šè¿‡è·¯ç”±æ‹¦æˆªä»¥æ¨¡æ€æ¡†å½¢å¼å±•ç¤ºè¯¦æƒ…ä¿¡æ¯ã€‚è¿™ç§è®¾è®¡ä¸ä»…èƒ½å¤Ÿæ”¹å˜æµè§ˆå™¨åœ°å€ï¼Œæ–¹ä¾¿åˆ†äº«ï¼Œè¿˜èƒ½è®©å¥½å‹æ‰“å¼€é“¾æ¥æ—¶ç›´æ¥è¿›å…¥å¯¹åº”çš„äº§å“è¯¦æƒ…é¡µï¼Œè€Œæ— éœ€å†ç»è¿‡åˆ—è¡¨é¡µã€‚è¿™ç§ä½“éªŒåœ¨å›½å¤–åº”ç”¨åœºæ™¯ä¸­éå¸¸å¸¸è§ï¼Œå¹¶ä¸”ç”¨æˆ·åé¦ˆè¾ƒå¥½ã€‚

å…ˆçœ‹ç¤ºä¾‹ï¼š

![](./imgs/nextjs_intercepting_routes.gif)

åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å®é™…ä¸Šä¼šæ¶‰åŠ **3 ä¸ªé¡µé¢**ï¼š**åˆ—è¡¨é¡µ**ã€**æ¨¡æ€æ¡†** å’Œ **è¯¦æƒ…é¡µ**ã€‚å…·ä½“æ¥è¯´ï¼š

1. **åˆ—è¡¨é¡µ**ï¼šè¿™æ˜¯ç”¨æˆ·é¦–å…ˆçœ‹åˆ°çš„ä¸»é¡µé¢ï¼Œå±•ç¤ºäº†æ‰€æœ‰äº§å“çš„åˆ—è¡¨ã€‚
2. **æ¨¡æ€æ¡†**ï¼šé€šè¿‡è·¯ç”±æ‹¦æˆªå®ç°ï¼Œå®ƒå®é™…ä¸Šå¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªç‹¬ç«‹çš„é¡µé¢ï¼Œåªä¸è¿‡æ˜¯åœ¨åˆ—è¡¨é¡µçš„åŸºç¡€ä¸Šä»¥æµ®å±‚ï¼ˆæ¨¡æ€æ¡†ï¼‰çš„å½¢å¼å åŠ å±•ç¤ºã€‚
3. **è¯¦æƒ…é¡µ**ï¼šè¿™æ˜¯ç›®æ ‡é¡µé¢ï¼Œå½“ç”¨æˆ·ç›´æ¥é€šè¿‡åˆ†äº«çš„é“¾æ¥è®¿é—®æ—¶ï¼Œä¼šå±•ç¤ºå®Œæ•´çš„äº§å“è¯¦æƒ…å†…å®¹ï¼Œæ›¿ä»£åˆ—è¡¨é¡µã€‚

åœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œå½“ç”¨æˆ·åœ¨åˆ—è¡¨é¡µç‚¹å‡»æŸä¸ªäº§å“æ—¶ï¼Œåˆ©ç”¨ **è·¯ç”±æ‹¦æˆª** å°†ç›®æ ‡é¡µé¢ä»¥æ¨¡æ€æ¡†å½¢å¼å±•ç¤ºï¼Œè€Œéå®Œå…¨è·³è½¬åˆ°è¯¦æƒ…é¡µã€‚æ­¤æ—¶ï¼Œé¡µé¢å®é™…ä¸ŠåŒæ—¶å‘ˆç°äº† **åˆ—è¡¨é¡µ** å’Œ **æ¨¡æ€æ¡†**ï¼ˆä¹Ÿå°±æ˜¯æ‹¦æˆªçš„è·¯ç”±é¡µé¢ï¼‰ã€‚

è¿™ç§æ•ˆæœå¯ä»¥é€šè¿‡ **å¹¶è¡Œè·¯ç”±** æ¥å®ç°ã€‚å¹¶è¡Œè·¯ç”±å…è®¸å¼€å‘è€…å®šä¹‰å¤šä¸ªè·¯ç”±åŒºåŸŸï¼Œè®©é¡µé¢èƒ½å¤Ÿåœ¨ä¸»åŒºåŸŸæ¸²æŸ“åˆ—è¡¨çš„åŒæ—¶ï¼Œåœ¨å¦ä¸€ä¸ªåŒºåŸŸï¼ˆå¦‚æ¨¡æ€æ¡†ï¼‰æ¸²æŸ“è¯¦æƒ…å†…å®¹ï¼Œä»è€Œå®ç°å¤šè§†å›¾ååŒæ˜¾ç¤ºã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºç›®å½•ï¼š

```
.
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ @modal/              # å¹¶è¡Œè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ (.)photos/       # æ‹¦æˆªè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ [id]/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx # æ‹¦æˆªè·¯ç”±é¡µé¢
â”‚   â”‚   â””â”€â”€ default.tsx      # é»˜è®¤è·¯ç”±
â”‚   â”œâ”€â”€ photos/              # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ [id]/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ layout.tsx           # æ ¹è·¯ç”±
â”‚   â”œâ”€â”€ page.tsx             # åˆ—è¡¨é¡µ
â”‚   â””â”€â”€ default.tsx          # é»˜è®¤è·¯ç”±
â””â”€â”€ lib/
    â””â”€â”€ data.ts              # æ¨¡æ‹Ÿæ•°æ®
```

> æç¤ºï¼šæ‹¦æˆªè·¯ç”±å‰é¢çš„ `(.)` è¡¨ç¤ºåœ¨å½“å‰å±‚çº§ä¸­åŒ¹é… `photos` è·¯ç”±ï¼Œå¦‚æœæ˜¯è¿”å›ä¸Šä¸€çº§å¯ä»¥è¿™æ ·è¡¨ç¤º `(..)`ï¼Œæ›´å¤šè·¯ç”±å±‚çº§åŒ¹é…è¡¨ç¤ºæ³•è¯·å‚è€ƒ [è¿™é‡Œ >>](https://nextjs.org/docs/app/building-your-application/routing/intercepting-routes#convention)

ç›´æ¥è´´ä»£ç ï¼š

ğŸ“‚ `lib/data.ts`

```ts
export const products = [
  {
    id: 1,
    name: "Earthen Bottle",
    price: "$48",
    imageSrc: "https://tailwindui.com/plus/img/ecommerce-images/category-page-04-image-card-03.jpg",
    imageAlt: "Tall slender porcelain bottle with natural clay textured body and cork stopper.",
  },
  {
    id: 2,
    name: "Nomad Tumbler",
    price: "$35",
    imageSrc: "https://tailwindui.com/plus/img/ecommerce-images/category-page-04-image-card-04.jpg",
    imageAlt: "Olive drab green insulated bottle with flared screw lid and flat top.",
  },
  {
    id: 3,
    name: "Focus Paper Refill",
    price: "$89",
    imageSrc: "https://tailwindui.com/plus/img/ecommerce-images/category-page-04-image-card-05.jpg",
    imageAlt: "Person using a pen to cross a task off a productivity paper card.",
  },
  {
    id: 4,
    name: "Machined Mechanical Pencil",
    price: "$35",
    imageSrc: "https://tailwindui.com/plus/img/ecommerce-images/category-page-04-image-card-07.jpg",
    imageAlt: "Hand holding black machined steel mechanical pencil with brass tip and top.",
  },
];
```

ğŸ“‚ `app/layout.tsx`

```tsx
export default function RootLayout({
  children,
  modal
}: Readonly<{
  children: React.ReactNode;
  modal: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        {children}
      	{modal}
      </body>
    </html>
  );
}
```

ğŸ“‚ `app/page.tsx`

```tsx
import { products } from "@/lib/data";
import Image from "next/image";
import Link from "next/link";

export default function Page() {
  return (
    <div className="bg-white">
      <div className="mx-auto max-w-2xl px-4 py-16 sm:px-6 sm:py-24 lg:max-w-7xl lg:px-8">
        <h2 className="sr-only">Products</h2>

        <div className="grid grid-cols-1 gap-x-6 gap-y-10 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 xl:gap-x-8">
          {products.map((product) => (
            <Link key={product.id} href={`/intercepting-routes/photos/${product.id}`} className="group">
              <Image
                alt={product.imageAlt}
                src={product.imageSrc}
                className="aspect-square w-full rounded-lg bg-gray-200 object-cover group-hover:opacity-75 xl:aspect-[7/8]"
                width={400}
                height={800}
              />
              <h3 className="mt-4 text-sm text-gray-700">{product.name}</h3>
              <p className="mt-1 text-lg font-medium text-gray-900">{product.price}</p>
            </Link>
          ))}
        </div>
      </div>
    </div>
  );
}

```

ğŸ“‚ `app/photos/[id]/page.tsx`

```tsx
import { products } from "@/lib/data";
import Image from "next/image";
import React, { use } from "react";

export default function Page({ params }: { params: Promise<{ id: string }> }) {
  const { id } = use(params);
  const photo = products.find((item) => item.id === +id)!;
  return (
    <div className="container mx-auto mt-8">
      <Image src={photo.imageSrc} alt={photo.imageAlt} width={400} height={400} className=" rounded-lg block mx-auto" />
      <div className="border-2 border-dashed border-gray-500 rounded-lg p-3 mt-6 leading-8">
        <p>
          <strong>Title:</strong>
          {photo.name}
        </p>
        <p>
          <strong>Price:</strong>
          {photo.price}
        </p>
        <p>
          <strong>Desc:</strong>
          Laborum cupidatat velit aute occaecat. Laborum deserunt reprehenderit aliqua ullamco magna deserunt magna nulla consectetur ullamco enim dolore ipsum nostrud. Excepteur commodo labore
          cupidatat amet incididunt dolor non consequat occaecat minim deserunt aliqua. Ut labore ut reprehenderit tempor aliqua eu fugiat exercitation aliquip culpa. Minim nostrud ipsum duis dolor
          non fugiat cupidatat anim id incididunt eu aute duis. In commodo fugiat ut culpa duis tempor laborum. Do laborum minim mollit sunt adipisicing Lorem cillum nostrud aliqua eiusmod irure
          tempor sit veniam. Veniam non dolore officia Lorem dolore. Ipsum enim occaecat aliqua est do. Exercitation ea id Lorem do consectetur non dolore irure dolore sint non. Deserunt laboris
          cillum pariatur consectetur non ex irure excepteur tempor incididunt. Mollit do sit minim officia incididunt officia magna officia sit. Aute enim nulla adipisicing deserunt velit eu occaecat
          dolore nisi sint. Aute occaecat laborum dolor minim nisi nisi laboris. Irure sint reprehenderit ex mollit culpa irure laborum duis. Laboris reprehenderit aliquip commodo sint cupidatat id
          sit deserunt culpa.
        </p>
      </div>
    </div>
  );
}
```

ğŸ“‚ `@modal/(.)photos/[id]/page.tsx`

```tsx
"use client";
import { products } from "@/lib/data";
import Image from "next/image";
import { useParams, useRouter } from "next/navigation";
import React from "react";

export default function Page() {
  const params = useParams<{ id: string }>();
  const photo = products.find((item) => item.id === +params.id)!;
  const router = useRouter();
  return (
    <div className="flex justify-center items-center fixed inset-0 bg-gray-500/[.8]" onClick={router.back}>
      <Image src={photo.imageSrc} width={300} height={600} alt={photo.imageAlt} className="rounded-lg object-cover " onClick={(e) => e.stopPropagation()} />
    </div>
  );
}
```

## è·¯ç”±å¤„ç†ç¨‹åº

https://nextjs.org/docs/app/building-your-application/routing/route-handlers

è¿™é‡Œçš„è·¯ç”±å¤„ç†ç¨‹åºï¼Œå¯ä»¥ç†è§£æˆå°±æ˜¯åœ¨å®šä¹‰APIæ¥å£ï¼ŒAPI è·¯ç”±ç”¨äºå¤„ç†æœåŠ¡å™¨ç«¯è¯·æ±‚ï¼Œä¸»è¦å®šä¹‰åœ¨ pages/api æˆ– app ç›®å½•ä¸­ã€‚

å‡è®¾ç°åœ¨å®šä¹‰åšå®¢æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰è·¯ç”±ï¼š`app/api/blogs/route.ts`ï¼Œç„¶åå¤„ç†æ¥å£é€»è¾‘ï¼š

```ts
import mockjs from "mockjs";
import { NextResponse } from 'next/server'
export async function GET(request: Request) {
  const data = mockjs.mock({
    code: 200,
    message: 'success',
    'data|5': [
      {
        'id|+1': 1,
        title: '@title',
        content: '@paragraph',
        create_time: '@datetime'
      }
    ]
  })
  return NextResponse.json(data)
}
```

ç°åœ¨ä½ å¯ä»¥è®¿é—®æ¥å£åœ°å€ http://localhost:3000/api/blogsï¼ˆåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼‰ï¼Œå°†ä¼šè¾“å‡ºå“åº”ç»“æœã€‚

> æç¤ºï¼šå…³äº route çš„æ›´å¤šæŒ‡å—ï¼Œè¯·å‚è€ƒ [è¿™é‡Œ >> ](https://nextjs.org/docs/app/api-reference/file-conventions/route)

## ä¸­é—´ä»¶

@See https://nextjs.org/docs/app/building-your-application/routing/middleware

## è·¯ç”±å‚æ•°

è¿™é‡Œä¸»è¦ä»‹ç»åœ¨æœåŠ¡ç«¯ç»„ä»¶å’Œå®¢æˆ·ç«¯ç»„ä»¶ä¸­è·å– `params` å’Œ `query` å‚æ•°çš„æ–¹å¼ï¼š

| #           | â˜ï¸ æœåŠ¡ç«¯ç»„ä»¶             | ğŸ’» å®¢æˆ·ç«¯ç»„ä»¶        |
| ----------- | ------------------------ | ------------------- |
| è·å–Params  | `props.params` â€” Promise | `useParams()`       |
| è·å–Queries | `props.searchParams`     | `useSearchParams()` |

# æ•°æ®è·å–

@See https://nextjs.org/docs/app/building-your-application/data-fetching

è¿™é‡Œä¸»è¦æ˜¯ä»‹ç»åœ¨ **å‰åç«¯åˆ†ç¦»** çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•è·å–æ•°æ®

1. åœ¨æœåŠ¡å™¨ä¸Šï¼Œä½¿ç”¨ fetch
2. åœ¨å®¢æˆ·ç«¯ä¸Šï¼Œé€šè¿‡è·¯ç”±å¤„ç†ç¨‹åº

## æ•°æ®è·å–

### åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨ fetch è·å–æ•°æ®

è¯¥ç»„ä»¶å°†è·å–å¹¶æ˜¾ç¤ºåšå®¢æ–‡ç« åˆ—è¡¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ**ä¸ç¼“å­˜** æ¥è‡ª fetch çš„å“åº”ï¼Œè¿™æ„å‘³ç€æ¯æ¬¡è®¿é—®é¡µé¢æ—¶éƒ½ä¼šé‡æ–°å‘é€è¯·æ±‚å¹¶è·å–æœ€æ–°çš„æ•°æ®ã€‚

```tsx
export default async function Page() {
  const data = await fetch("https://jsonplaceholder.typicode.com/posts");
  const posts = await data.json();
  return (
    <ul>
      {posts.map((post: any) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  );
}Ã
```

å¦‚æœæ­¤è·¯ç”±ä¸­æ²¡æœ‰ä½¿ç”¨ä»»ä½• **åŠ¨æ€ API**ï¼ˆå¦‚ cookies()ã€headers() æˆ– searchParamsï¼‰ï¼ŒNext.js ä¼šåœ¨æ„å»ºé˜¶æ®µï¼ˆnext buildï¼‰å¯¹è¯¥é¡µé¢è¿›è¡Œ**é¢„æ¸²æŸ“ï¼ˆPrerenderingï¼‰**ï¼Œç”Ÿæˆä¸€ä¸ªé™æ€é¡µé¢ï¼ˆStatic Pageï¼‰ã€‚

è¿™ç§é™æ€æ¸²æŸ“çš„é¡µé¢å†…å®¹å¯ä»¥é€šè¿‡ **Incremental Static Regeneration (ISR)** æ›´æ–°ï¼Œä¹Ÿå°±æ˜¯ä»¥å¢é‡æ–¹å¼é‡æ–°ç”Ÿæˆé¡µé¢å†…å®¹ã€‚

å¦‚æœå¸Œæœ›é˜»æ­¢é¡µé¢åœ¨æ„å»ºé˜¶æ®µè¢«é™æ€åŒ–ï¼Œå¯ä»¥æ˜¾å¼è®¾ç½® dynamic = 'force-dynamic'ã€‚ä¾‹å¦‚ï¼š

```ts
export const dynamic = 'force-dynamic';
```

è¿™æ ·ï¼Œé¡µé¢ä¼šåœ¨æ¯æ¬¡è¯·æ±‚æ—¶åŠ¨æ€ç”Ÿæˆï¼Œè€Œä¸ä¼šè¢«é¢„æ¸²æŸ“ä¸ºé™æ€é¡µé¢ã€‚

> ç»“è®ºï¼š
>
> - å¦‚æœä»£ç ä¸­æ²¡æœ‰åŠ¨æ€ä¾èµ–ï¼Œé¡µé¢ä¼šåœ¨æ„å»ºæ—¶è¢«é¢„æ¸²æŸ“ä¸ºé™æ€é¡µé¢ï¼Œæ”¯æŒé€šè¿‡ ISR æ›´æ–°ã€‚
> - å¦‚æœéœ€è¦åŠ¨æ€è¡Œä¸ºï¼Œå¯ä»¥æ˜¾å¼ä½¿ç”¨ dynamic = 'force-dynamic' æˆ–é€šè¿‡ä½¿ç”¨åŠ¨æ€ API è‡ªåŠ¨åˆ‡æ¢ä¸ºåŠ¨æ€æ¸²æŸ“æ¨¡å¼ã€‚
> - åŠ¨æ€æ¸²æŸ“æ¨¡å¼å¯¹éœ€è¦åŸºäºè¯·æ±‚çš„å®æ—¶æ•°æ®ç”Ÿæˆé¡µé¢éå¸¸é‡è¦ï¼Œæ¯”å¦‚ä¸ªæ€§åŒ–å†…å®¹æˆ–ä¾èµ–æœ€æ–°æ•°æ®çš„åº”ç”¨åœºæ™¯ã€‚
>
> æ³¨æ„ï¼š**Next.js 15.x ç‰ˆæœ¬ä¹‹å‰ï¼Œè°ƒç”¨ fetch å‡½æ•°è¯·æ±‚æ•°æ®ï¼Œæ˜¯é»˜è®¤ç¼“å­˜çš„ï¼Œä¹Ÿå°±æ˜¯ `{ cache: 'force-cache' }`ï¼Œåœ¨ v15.x ç‰ˆæœ¬ä¹‹åï¼Œé»˜è®¤ä¸ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯ `{ cache: 'no-store' }`ã€‚**

### åœ¨å®¢æˆ·ç«¯è·å–æ•°æ®

å®˜æ–¹å»ºè®®é¦–å…ˆå°è¯•åœ¨æœåŠ¡å™¨ç«¯è·å–æ•°æ®ï¼Œç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯æ•°æ®è·å–ä»ç„¶æœ‰æ„ä¹‰ã€‚åœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œæ‚¨å¯ä»¥åœ¨ `useEffect` ä¸­æ‰‹åŠ¨è°ƒç”¨ fetch ï¼ˆä¸æ¨èï¼‰ã€‚

## æ·»åŠ æœç´¢å’Œåˆ†é¡µ

ä¸ºä»€ä¹ˆä½¿ç”¨ URL æœç´¢å‚æ•°ï¼Ÿä½¿ç”¨ URL å‚æ•°å®ç°æœç´¢æœ‰å‡ ä¸ªå¥½å¤„ï¼š

1. å¯æ·»åŠ ä¹¦ç­¾å’Œå¯å…±äº«çš„ URLï¼šç”±äºæœç´¢å‚æ•°ä½äº URL ä¸­ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥ä¸ºåº”ç”¨ç¨‹åºçš„å½“å‰çŠ¶æ€ï¼ˆåŒ…æ‹¬å…¶æœç´¢æŸ¥è¯¢å’Œè¿‡æ»¤å™¨ï¼‰æ·»åŠ ä¹¦ç­¾ï¼Œä»¥ä¾›å°†æ¥å‚è€ƒæˆ–å…±äº«ã€‚
2. æœåŠ¡ç«¯æ¸²æŸ“å’Œåˆå§‹åŠ è½½ï¼šå¯ä»¥åœ¨æœåŠ¡ç«¯ç›´æ¥ä½¿ç”¨URLå‚æ•°æ¥æ¸²æŸ“åˆå§‹çŠ¶æ€ï¼Œä»è€Œæ›´å®¹æ˜“å¤„ç†æœåŠ¡ç«¯æ¸²æŸ“ã€‚
3. åˆ†æå’Œè·Ÿè¸ªï¼šç›´æ¥åœ¨ URL ä¸­è¿›è¡Œæœç´¢æŸ¥è¯¢å’Œè¿‡æ»¤å™¨å¯ä»¥æ›´è½»æ¾åœ°è·Ÿè¸ªç”¨æˆ·è¡Œä¸ºï¼Œè€Œæ— éœ€é¢å¤–çš„å®¢æˆ·ç«¯é€»è¾‘ã€‚

å®ç°æœç´¢åŠŸèƒ½ç›¸å…³çš„ Next.js é’©å­

1. **`useSearchParams`**ï¼šå…è®¸æ‚¨è®¿é—®å½“å‰ URL çš„å‚æ•°ã€‚ä¾‹å¦‚ï¼Œæ­¤ URL /dashboard/invoices?page=1&query=pending çš„æœç´¢å‚æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š{page: '1', query: 'pending'}ã€‚
2. **`usePathname`**ï¼šè®©æ‚¨è¯»å–å½“å‰ URL çš„è·¯å¾„åã€‚ä¾‹å¦‚ï¼Œå¯¹äºè·¯ç”± /dashboard/invoicesï¼ŒusePathname å°†è¿”å›â€œ/dashboard/invoicesâ€ã€‚
3. **`useRouter`**ï¼šä»¥ç¼–ç¨‹æ–¹å¼å¯ç”¨å®¢æˆ·ç«¯ç»„ä»¶å†…çš„è·¯ç”±ä¹‹é—´çš„å¯¼èˆª

> æ¸©é¦¨æç¤ºï¼š
>
> - å®¢æˆ·ç«¯ç»„ä»¶ï¼šä½¿ç”¨ `useSearchParams()`
> - æœåŠ¡ç«¯ç»„ä»¶ï¼šä½¿ç”¨ `props.searchParams`

# æ¸²æŸ“

@See https://nextjs.org/docs/app/building-your-application/rendering

åœ¨Next.jsä¸­ï¼Œç»„ä»¶ä¸»è¦è¢«åˆ’åˆ†ä¸ºä¸¤å¤§ç±»ï¼šæœåŠ¡ç«¯ç»„ä»¶ä¸å®¢æˆ·ç«¯ç»„ä»¶ã€‚è¿™ä¸¤ç±»ç»„ä»¶å„è‡ªæ‰®æ¼”ç€é‡è¦çš„è§’è‰²ï¼ŒåŒæ—¶åˆä¼šåœ¨é¡µé¢æ„å»ºè¿‡ç¨‹ä¸­ç›¸äº’åä½œä¸å¼•ç”¨ã€‚

## æœåŠ¡ç«¯ç»„ä»¶

### æœåŠ¡ç«¯ç»„ä»¶ä¼˜ç‚¹

1. æ€§èƒ½æå‡ï¼šå‡å°‘è·å–æ•°æ®çš„æ—¶é—´ï¼›å¯ä»¥ç¼“å­˜æœåŠ¡å™¨æ¸²æŸ“çš„ç»“æœä¾›åç»­è¯·æ±‚å¤ç”¨ã€‚
2. å®‰å…¨æå‡ï¼šå¯ä»¥å°†æ•æ„Ÿæ•°æ®ï¼ˆä¾‹å¦‚ä»¤ç‰Œå’ŒAPIå¯†é’¥ï¼‰å’Œé€»è¾‘ä¿ç•™åœ¨æœåŠ¡å™¨ç«¯ï¼Œé¿å…è¢«å®¢æˆ·ç«¯æš´éœ²ã€‚
3. é¡µé¢åˆå§‹åŠ è½½é€Ÿåº¦æå‡ï¼šæœåŠ¡ç«¯å¯ä»¥ç›´æ¥ç”ŸæˆHTMLé¡µé¢ï¼Œè®©ç”¨æˆ·ç«‹å³çœ‹åˆ°å†…å®¹ï¼Œæ— éœ€ç­‰å¾…å®¢æˆ·ç«¯ä¸‹è½½ã€è§£æå’Œæ‰§è¡ŒJavaScriptã€‚å¹¶ä¸”é€šè¿‡æµå¼ä¼ è¾“æŠ€æœ¯ï¼Œå°†æ¸²æŸ“å·¥ä½œæ‹†åˆ†æˆå—ï¼Œè®©ç”¨æˆ·æ›´æ—©çœ‹åˆ°é™æ€é¡µé¢ã€‚
4. æœç´¢å¼•æ“ä¼˜åŒ–SEOã€‚

### å¦‚ä½•å¯ç”¨æœåŠ¡ç«¯ç»„ä»¶ï¼Ÿ

é»˜è®¤æƒ…å†µä¸‹ï¼ŒNext.js ä½¿ç”¨æœåŠ¡å™¨ç»„ä»¶ã€‚

### æœåŠ¡ç«¯ç»„ä»¶æµå¼æ¸²æŸ“

å½“è¿›å…¥ä¸€ä¸ªæ–°é¡µé¢æ—¶ï¼Œå¦‚æœéœ€è¦å‘é€è¯·æ±‚ä»¥è·å–é¡µé¢æ•°æ®ï¼Œç”±äºæ¥å£å“åº”å­˜åœ¨å»¶è¿Ÿï¼Œé¡µé¢åœ¨è¿™æ®µæ—¶é—´å†…æ— æ³•å‘ˆç°ã€‚å¯ä½¿ç”¨æµå¼æ¸²æŸ“æ–¹å¼ï¼Œå…ˆå‘ˆç°é¡µé¢çš„é™æ€å†…å®¹ï¼ŒåŠ¨æ€å†…å®¹ä½¿ç”¨éª¨æ¶å±ç­‰æ–¹å¼æç¤ºåŠ è½½ä¸­ã€‚

é€šè¿‡æµå¼æ¸²æŸ“ï¼Œå¯ä»¥é˜²æ­¢ç¼“æ…¢çš„æ•°æ®è¯·æ±‚é˜»å¡æ•´ä¸ªé¡µé¢ã€‚è¿™å…è®¸ç”¨æˆ·æŸ¥çœ‹é¡µé¢çš„éƒ¨åˆ†å†…å®¹å¹¶ä¸ä¹‹äº¤äº’ï¼Œè€Œæ— éœ€ç­‰å¾…æ‰€æœ‰æ•°æ®åŠ è½½åå†å‘ç”¨æˆ·æ˜¾ç¤ºä»»ä½• UIã€‚

åœ¨ Next.js ä¸­å®ç°æµå¼ä¼ è¾“æœ‰ä¸¤ç§æ–¹æ³•ï¼š

1. åœ¨é¡µé¢çº§åˆ«ï¼Œä½¿ç”¨ loading.tsx æ–‡ä»¶ã€‚
2. å¯¹äºç‰¹å®šç»„ä»¶ï¼Œç”¨\<Suspense>

> æ³¨æ„ï¼šè¯·ä¸è¦åœ¨é¡¶å±‚ç»„ä»¶ä¸­ç›´æ¥å‘èµ·æ¥å£è¯·æ±‚ï¼Œå› ä¸ºåœ¨ç­‰å¾…æ¥å£å“åº”çš„ await æœŸé—´ï¼Œå¼‚æ­¥ç»„ä»¶å°†ä¸ä¼šè¿›è¡Œæ¸²æŸ“ï¼Œè¿™ä¼šå¯¼è‡´å…¶ä»–ä¸ä¾èµ–äºæ¥å£æ•°æ®çš„é™æ€å†…å®¹ä¹Ÿæ— æ³•æ­£å¸¸æ˜¾ç¤ºã€‚æ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯ï¼Œå°†æ•°æ®è¯·æ±‚çš„é€»è¾‘æ”¾åœ¨å­ç»„ä»¶ä¸­ï¼Œå¹¶åœ¨é¡µé¢ç»„ä»¶ä¸­ä½¿ç”¨Suspenseæ¥åŒ…è£¹è¿™ä¸ªå­ç»„ä»¶ã€‚å¦‚æœæ•´ä¸ªé¡µé¢çš„å†…å®¹éƒ½ä¾èµ–äºæ¥å£æ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥åˆ›å»º loading.tsx æ–‡ä»¶æ¥å®ç°ï¼Œä»¥ç¡®ä¿åœ¨æ•°æ®åŠ è½½å®Œæˆå‰æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨æˆ–å ä½å†…å®¹ã€‚
>
> æç¤ºï¼šåœ¨Suspenseä¸­æ˜¾ç¤ºçš„æœåŠ¡ç«¯ç»„ä»¶ï¼Œä¸ä¼šå½±å“SEOï¼Œä¾æ—§èƒ½å¤Ÿè¢«è·å–åˆ°ã€‚å¯å°†è‡ªå·±çš„ç½‘ç«™éƒ¨ç½²åï¼Œè®¿é—®ï¼š**å¯Œåª’ä½“æœç´¢ç»“æœæµ‹è¯•** ([ç‚¹å‡»å‰å¾€ >> ](https://search.google.com/test/rich-results/result )) è¿›è¡ŒSEOæµ‹è¯•

### æœåŠ¡ç«¯ç»„ä»¶æ•°æ®å…±äº«

åœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­ï¼Œä¸èƒ½ä½¿ç”¨ React Context æ¥åˆ›å»ºæ•°æ®å…±äº«ï¼ŒReact Context API åªèƒ½åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­ä½¿ç”¨ã€‚åŒæ ·åœ°ï¼Œè¯¸å¦‚Reduxç­‰çŠ¶æ€ç®¡ç†åº“ï¼Œç”±äºå®ƒä»¬ä¾èµ–äºReactçš„`Hook`æœºåˆ¶ï¼Œè€Œhookåªèƒ½åœ¨å®¢æˆ·ç«¯ç»„ä»¶çš„æ¸²æŸ“è¿‡ç¨‹ä¸­ä½¿ç”¨ï¼Œå› æ­¤åœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­ä¹Ÿæ— æ³•åº”ç”¨è¿™äº›çŠ¶æ€ç®¡ç†åº“ã€‚

åœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­è¿›è¡Œæ•°æ®å…±äº«å…±æœ‰ä¸‰ç§æ–¹å¼ï¼š

1. é€šè¿‡ Propsï¼Œçˆ¶ç»„ä»¶å°†å€¼ä¼ é€’ç»™å­ç»„ä»¶ã€‚
2. é€šè¿‡ Cache APIï¼Œç¼“å­˜æ•°æ®è·å–æˆ–è®¡ç®—ç»“æœï¼Œå¸¸ç”¨äºç¼“å­˜æ•°æ®åº“æ“ä½œæŸ¥è¯¢ç»“æœã€‚
3. é€šè¿‡ fetch APIï¼ŒNext.js æ‹“å±•äº†åŸç”Ÿçš„ fetchï¼Œå¢åŠ äº†ç¼“å­˜å’Œé‡æ–°éªŒè¯æœºåˆ¶ï¼Œåœ¨ç¼“å­˜æœŸé—´å†…å¤šæ¬¡è¯·æ±‚ï¼Œä¸ä¼šå‘åç«¯å‘é€è¯·æ±‚ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ç¼“å­˜çš„ç»“æœã€‚

### åœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­è°ƒç”¨ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ç»„ä»¶åº“

åœ¨ä¸€äº›ç¬¬ä¸‰æ–¹åº“ä¸­ï¼Œæ¯”å¦‚Swiperï¼Œä½¿ç”¨åˆ°äº† hookï¼Œä¾‹å¦‚useStateï¼Œä½†å†…éƒ¨åˆæ²¡æœ‰ä½¿ç”¨ `use client` æ˜¾å¼å£°æ˜ä¸ºå®¢æˆ·ç«¯ç»„ä»¶ï¼Œå¦‚æœç›´æ¥åœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­ä½¿ç”¨ï¼Œä¼šæŠ¥é”™ã€‚

è§£å†³åŠæ³•ï¼šåœ¨å¤–å±‚è‡ªå®šä¹‰ä¸ºå®¢æˆ·ç«¯ç»„ä»¶

## å®¢æˆ·ç«¯ç»„ä»¶

### å®¢æˆ·ç«¯ç»„ä»¶ä¼˜ç‚¹

1. äº¤äº’æ€§ï¼šå®¢æˆ·ç«¯ç»„ä»¶å¯ä»¥ä½¿ç”¨ stateï¼Œeffects å’Œäº‹ä»¶ç›‘å¬å™¨ã€‚
2. æµè§ˆå™¨APIï¼šå®¢æˆ·ç«¯ç»„ä»¶å¯ä»¥ä½¿ç”¨æµè§ˆå™¨APIï¼Œä¾‹å¦‚ localStorage

### å¦‚ä½•å¯ç”¨å®¢æˆ·ç«¯ç»„ä»¶ï¼Ÿ

åœ¨æ–‡ä»¶é¡¶éƒ¨ï¼Œ`import` ä¹‹å‰ï¼Œæ·»åŠ  `use client` ï¼Œæ˜¾å¼å£°æ˜ä¸ºå®¢æˆ·ç«¯ç»„ä»¶ï¼Œåœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­å¯¼å…¥å…¶ä»–æ¨¡å—ï¼Œéƒ½å°†è¢«è§†ä¸ºå®¢æˆ·ç«¯ç»„ä»¶çš„ä¸€éƒ¨åˆ†ã€‚

### æœåŠ¡ç«¯ç»„ä»¶ä¸å®¢æˆ·ç«¯ç»„ä»¶å¦‚ä½•é€‰æ‹©

åªè¦ç”¨åˆ° hook çš„æˆ–è€…æµè§ˆå™¨APIçš„ï¼Œéœ€ä½¿ç”¨å®¢æˆ·ç«¯ç»„ä»¶ï¼Œå…¶ä½™æƒ…å†µä½¿ç”¨æœåŠ¡ç«¯ç»„ä»¶ã€‚

## æœåŠ¡ç«¯ç»„ä»¶ä¸å®¢æˆ·ç«¯ç»„ä»¶æ··åˆä½¿ç”¨

åœ¨ä¸€ä¸ªé¡µé¢ä¸­ï¼Œä¸å¯é¿å…çš„å­˜åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸æœåŠ¡ç«¯ç»„ä»¶æ··åˆä½¿ç”¨çš„æƒ…å†µã€‚åœ¨ä½¿ç”¨ä¸­ï¼Œå°½é‡æŠŠæœåŠ¡ç«¯ç»„ä»¶å®šä¹‰åœ¨å¤–å±‚å»è·å–æ•°æ®ï¼ŒæŠŠå®¢æˆ·ç«¯ç»„ä»¶å®šä¹‰åœ¨æœ€é‡Œå±‚å»å¤„ç†ç”¨æˆ·äº¤äº’ã€‚

> æ³¨æ„ï¼šåœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­å¯ä»¥ä½¿ç”¨ `import` å¯¼å…¥å®¢æˆ·ç«¯ç»„ä»¶ï¼Œä½†åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­ä¸èƒ½ä½¿ç”¨ `import` å¯¼å…¥æœåŠ¡ç«¯ç»„ä»¶ï¼Œåªèƒ½æŠŠæœåŠ¡ç«¯ç»„ä»¶ä½œä¸º `props` ä¼ é€’ç»™å®¢æˆ·ç«¯ç»„ä»¶ã€‚

åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨ `import` å¯¼å…¥æœåŠ¡ç«¯ç»„ä»¶ï¼ˆé”™è¯¯ä½¿ç”¨ç¤ºä¾‹ï¼‰ï¼š

```tsx
"use client";

import { useState } from "react";
// You cannot import a Server Component into a Client Component.
import ServerComponent from "./ServerComponent";

export default function ClientComponent() {
  const [count, setCount] = useState(0);
  return (
    <>
      <button onClick={() => setCount(count + 1)}>{count}</button>
      <ServerComponent />
    </>
  );
}
```

å¦‚æœæœåŠ¡ç«¯ç»„ä»¶ä»…åŒ…å«é™æ€æ–‡ä»¶ï¼Œé€šå¸¸ä¸ä¼šå¼•å‘æŠ¥é”™ã€‚ç„¶è€Œï¼Œä¸€æ—¦æœåŠ¡ç«¯ç»„ä»¶ä¸­æ¶‰åŠåˆ°æ¥å£è¯·æ±‚ï¼Œå°±ä¼šå¯¼è‡´æ¥å£è¢«å¤šæ¬¡ä¸å¿…è¦åœ°è°ƒç”¨ï¼Œå¹¶ä¸”å¦‚æœæ¥å£æ•°æ®é¢‘ç¹å˜åŠ¨ã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡ç«¯è¯·æ±‚å¾—åˆ°çš„æ¥å£æ•°æ®å¯èƒ½ä¸å®¢æˆ·ç«¯è¯·æ±‚çš„æ•°æ®ä¸ä¸€è‡´ï¼Œè¿›è€Œå¼•å‘æ¸²æŸ“é”™è¯¯ã€‚

æ­£ç¡®åšæ³•ï¼ŒæŠŠæœåŠ¡ç«¯ç»„ä»¶ä½œä¸ºpropsä¼ é€’ç»™å®¢æˆ·ç«¯ç»„ä»¶

```tsx
"use client";
import { useState } from "react";
export default function ClientComponent({ children }: { children: React.ReactNode }) {
  const [count, setCount] = useState(0);
  return (
    <>
      <button onClick={() => setCount(count + 1)}>{count}</button>
      {children}
    </>
  );
}
```

```tsx
import ClientComponent from "./client-component";
import ServerComponent from "./server-component";

// Pages in Next.js are Server Components by default
export default function Page() {
  return (
    <ClientComponent>
      <ServerComponent />
    </ClientComponent>
  );
}
```

## ä¿æŠ¤æ•æ„Ÿä¿¡æ¯

#### é˜²æ­¢å®¢æˆ·ç«¯ç»„ä»¶è°ƒç”¨åº”åœ¨æœåŠ¡ç«¯ä½¿ç”¨çš„æ–¹æ³•

åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œä¼šåŒæ—¶å­˜åœ¨æœåŠ¡ç«¯ç»„ä»¶å’Œå®¢æˆ·ç«¯ç»„ä»¶ã€‚å¦‚æœå•äººå¼€å‘ï¼Œå¯ä»¥è‡ªå·±æ³¨æ„è§„èŒƒï¼Œä¾‹å¦‚ä¸ç”¨å®¢æˆ·ç«¯ç»„ä»¶å»è¯·æ±‚æ¥å£ï¼Œé˜²æ­¢è¯·æ±‚è·¯å¾„å¯¹å¤–æš´éœ²ã€‚ä½†åœ¨å›¢é˜Ÿåä½œæ—¶ï¼Œå£å¤´çº¦å®šæ˜¾ç„¶æ˜¯ä¸ä¿é™©çš„ã€‚

ä¾‹å¦‚æœ‰ä¸€ä¸ªè·å–æ¥å£æ•°æ®çš„æ–¹æ³•ï¼Œä¸ºäº†ä¸ä½¿è¯·æ±‚è·¯å¾„æš´éœ²å‡ºå»ï¼Œè¯¥æ–¹æ³•åªèƒ½åœ¨æœåŠ¡ç«¯ä½¿ç”¨ã€‚

```tsx
//api.ts
export async function getData() {
  const res = await fetch('https://external-service.com/data', {
    headers: {
      authorization: process.env.API_KEY,
    },
  })
  return res.json()
}
```

ä¸ºäº†é˜²æ­¢å…¶ä»–å¼€å‘è€…åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­ä½¿ç”¨è¯¥æ¥å£ï¼Œéœ€ä½¿ç”¨server-onlyåº“æ˜¾å¼å£°æ˜ä¸ºåªèƒ½åœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­ä½¿ç”¨

1ï¼‰å®‰è£…

```shell
$ pnpm add server-only
```

2ï¼‰ä½¿ç”¨

```ts
//api.ts
import 'server-only'

//... 
```

è¿™æ ·å¦‚æœåœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­ä½¿ç”¨ api.ts æ–‡ä»¶ä¸­å®šä¹‰çš„å‡½æ•°ï¼Œç»ˆç«¯å°†æŠ¥é”™ã€‚

#### é˜²æ­¢å®¢æˆ·ç«¯ç»„ä»¶è°ƒç”¨ç§æœ‰ç¯å¢ƒå˜é‡

åœ¨ä¸Šè¿° api.ts ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†process.env.API_KEY  è·å–äº†å­˜åœ¨ç¯å¢ƒå˜é‡ä¸­çš„ token ä¿¡æ¯ã€‚ä¸ºäº†é˜²æ­¢ token ä¿¡æ¯è¢«æ— æ„é—´æš´éœ²å‡ºå»ï¼ˆåœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­ä½¿ç”¨ï¼‰ï¼Œç¯å¢ƒå˜é‡åä¸åº”ä½¿ç”¨ `NEXT_PUBLIC_` å‰ç¼€ï¼Œä¾‹å¦‚ä½¿ç”¨ API_KEYï¼Œåœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­è®¿é—®`process.env.API_KEY`ï¼Œå°†ä¼šå¾—åˆ°undefinedã€‚

å¦‚æœæƒ³å®šä¹‰æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯éƒ½èƒ½ä½¿ç”¨çš„ç¯å¢ƒå˜é‡ï¼Œå¯ä½¿ç”¨`NEXT_PUBLIC_`å‰ç¼€ï¼Œä¾‹å¦‚`NEXT_PUBLIC_URL`

# ç¼“å­˜

https://blog.csdn.net/Zong_0915/article/details/139375956

@See https://nextjs.org/docs/app/building-your-application/caching

æ¦‚è§ˆï¼š

| ç¼“å­˜æ¨¡å¼            | é…ç½®æ–¹å¼                   | é€‚ç”¨åœºæ™¯                               | æ•°æ®æ›´æ–°æ–¹å¼   |
| ------------------- | -------------------------- | -------------------------------------- | -------------- |
| é™æ€ç¼“å­˜            | `cache: 'force-cache'`     | ä¸å¸¸å˜åŒ–çš„æ•°æ®                         | æ„å»ºæ—¶å›ºå®š     |
| åŠ¨æ€ç¼“å­˜            | `cache: 'no-store'`        | å®æ—¶æ›´æ–°çš„æ•°æ®                         | æ¯æ¬¡è¯·æ±‚éƒ½åˆ·æ–° |
| å¢é‡é™æ€å†ç”Ÿæˆ(ISR) | `next: { revalidate: 60 }` | éœ€è¦å®šæœŸæ›´æ–°ä½†å¯å»¶è¿Ÿçš„æ•°æ®å®šæœŸé‡æ–°éªŒè¯ | å®šæœŸé‡æ–°éªŒè¯   |

é»˜è®¤æƒ…å†µä¸‹ï¼ŒNext.js ä¼šå°½å¯èƒ½å¤šåœ°ç¼“å­˜ä»¥æé«˜æ€§èƒ½å¹¶é™ä½æˆæœ¬ã€‚è¿™æ„å‘³ç€é™¤éæ‚¨é€‰æ‹©é€€å‡ºï¼Œå¦åˆ™è·¯ç”±å°†é™æ€å‘ˆç°å¹¶ä¸”æ•°æ®è¯·æ±‚å°†è¢«ç¼“å­˜ã€‚ç¼“å­˜è¡Œä¸ºä¼šå‘ç”Ÿå˜åŒ–ï¼Œå…·ä½“å–å†³äºè·¯çº¿æ˜¯é™æ€è¿˜æ˜¯åŠ¨æ€å‘ˆç°ã€æ•°æ®æ˜¯ç¼“å­˜è¿˜æ˜¯æœªç¼“å­˜ï¼Œä»¥åŠè¯·æ±‚æ˜¯åˆå§‹è®¿é—®è¿˜æ˜¯åç»­å¯¼èˆªçš„ä¸€éƒ¨åˆ†ã€‚æ ¹æ®æ‚¨çš„ä½¿ç”¨æ¡ˆä¾‹ï¼Œæ‚¨å¯ä»¥ä¸ºå„ä¸ªè·¯ç”±å’Œæ•°æ®è¯·æ±‚é…ç½®ç¼“å­˜è¡Œä¸ºã€‚

ä¸ºäº†æ›´åŠ ç›´è§‚çš„è®©å¤§å®¶çœ‹åˆ°ç¼“å­˜çš„ç”Ÿæ•ˆï¼Œæˆ‘ä»¬å¯ä»¥åœ¨`next.config.ts` æ–‡ä»¶ä¸­å¢åŠ ä»¥ä¸‹é…ç½®ï¼Œè¿™æ ·åœ¨`fetch`çš„æ—¶å€™ï¼Œå°±ä¼šæ‰“å°ç›¸å…³çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¼“å­˜æ˜¯å¦å‘½ä¸­ã€‚

```ts
import type { NextConfig } from "next";
const nextConfig: NextConfig = {
  logging: {
    fetches: { fullUrl: true }
  },
};
export default nextConfig;
```

## è¯·æ±‚è®°å¿†

@See https://nextjs.org/docs/app/building-your-application/caching#request-memoization

React å¯¹ fetch API è¿›è¡Œäº†æ‰©å±•ï¼Œä½¿å…¶èƒ½å¤Ÿè‡ªåŠ¨ç¼“å­˜å…·æœ‰ç›¸åŒ URL å’Œé€‰é¡¹çš„è¯·æ±‚ã€‚è¿™æ„å‘³ç€ä½ åœ¨ React ç»„ä»¶æ ‘çš„å¤šä¸ªä½ç½®è°ƒç”¨ç›¸åŒçš„è·å–å‡½æ•°æ—¶ï¼Œå®é™…çš„ç½‘ç»œè¯·æ±‚åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚

ä¾‹å¦‚ï¼Œå½“éœ€è¦è·¨è·¯ç”±å…±äº«æ•°æ®ï¼ˆå¦‚åœ¨å¸ƒå±€ã€é¡µé¢æˆ–å¤šä¸ªç»„ä»¶ä¸­ï¼‰æ—¶ï¼Œæ— éœ€åœ¨æ ‘çš„é¡¶å±‚è·å–æ•°æ®å¹¶é€šè¿‡ props é€å±‚ä¼ é€’ã€‚ç›¸åï¼Œå¯ä»¥ç›´æ¥åœ¨éœ€è¦çš„ç»„ä»¶ä¸­è·å–æ•°æ®ï¼Œè€Œæ— éœ€æ‹…å¿ƒå¯¹åŒä¸€èµ„æºé‡å¤å‘èµ·ç½‘ç»œè¯·æ±‚ä¼šå½±å“æ€§èƒ½ã€‚

## æ•°æ®ç¼“å­˜

@See https://nextjs.org/docs/app/building-your-application/caching#data-cache

Next.js æä¾›äº†ä¸€ç§å†…ç½®çš„æ•°æ®ç¼“å­˜æœºåˆ¶ï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨è¯·æ±‚ä¹‹é—´ä»¥åŠéƒ¨ç½²è¿‡ç¨‹ä¸­ä¿ç•™æ•°æ®è·å–çš„ç»“æœã€‚è¿™æ˜¯é€šè¿‡å¯¹åŸç”Ÿ fetch API çš„æ‰©å±•å®ç°çš„ï¼Œä½¿æ¯ä¸ªæœåŠ¡å™¨è¯·æ±‚éƒ½å¯ä»¥æ ¹æ®éœ€è¦å®šä¹‰è‡ªå·±çš„æŒä¹…åŒ–ç¼“å­˜ç­–ç•¥ã€‚

> â—ï¸æ³¨æ„ï¼šfetch çš„ç¼“å­˜é€‰é¡¹åœ¨æµè§ˆå™¨å’Œ Next.js ä¸­çš„è¡Œä¸ºæœ‰æ‰€ä¸åŒï¼š
>
> - **åœ¨æµè§ˆå™¨ä¸­**ï¼šç¼“å­˜é€‰é¡¹æ§åˆ¶è¯·æ±‚å¦‚ä½•ä¸æµè§ˆå™¨çš„ HTTP ç¼“å­˜äº¤äº’ï¼ˆä¾‹å¦‚æ˜¯å¦ä½¿ç”¨ç¼“å­˜æˆ–å¼ºåˆ¶é‡æ–°è·å–ï¼‰ã€‚
> - **åœ¨ Next.js ä¸­**ï¼šç¼“å­˜é€‰é¡¹å†³å®šæœåŠ¡å™¨ç«¯çš„è¯·æ±‚å¦‚ä½•ä¸æœåŠ¡å™¨ä¸Šçš„æ•°æ®ç¼“å­˜è¿›è¡Œäº¤äº’ï¼Œä»è€Œä¼˜åŒ–æ€§èƒ½å¹¶å‡å°‘ä¸å¿…è¦çš„ç½‘ç»œè¯·æ±‚ã€‚

å¯ä»¥ä½¿ç”¨ fetch çš„ cache å’Œ next.revalidate é€‰é¡¹æ¥é…ç½®ç¼“å­˜è¡Œä¸ºã€‚

æ•°æ®ç¼“å­˜å’Œè¯·æ±‚è®°å¿†è™½ç„¶éƒ½é€šè¿‡é‡ç”¨ç¼“å­˜æ•°æ®æ¥æå‡æ€§èƒ½ï¼Œä½†å®ƒä»¬åœ¨æŒä¹…æ€§å’Œä½œç”¨èŒƒå›´ä¸Šå­˜åœ¨æ˜¾è‘—å·®å¼‚ï¼š

- **æ•°æ®ç¼“å­˜**ï¼š
  - æ˜¯æŒä¹…åŒ–çš„ï¼Œå¯ä»¥åœ¨ä¸åŒçš„ä¼ å…¥è¯·æ±‚ä¹‹é—´å’Œéƒ¨ç½²è¿‡ç¨‹ä¸­ä¿ç•™ç¼“å­˜ç»“æœã€‚
  - é€‚ç”¨äºé•¿æ—¶é—´å¤ç”¨çš„æ•°æ®ï¼ˆå¦‚å…¬å…± API çš„ç»“æœï¼‰ã€‚
  - ç¼“å­˜çš„ä½œç”¨èŒƒå›´æ›´å¹¿ï¼Œè¶…å‡ºäº†å•ä¸ªè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸã€‚
- **è¯·æ±‚è®°å¿†**ï¼š
  - æ˜¯ä¸´æ—¶çš„ï¼Œä»…åœ¨å½“å‰è¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸå†…æœ‰æ•ˆã€‚
  - ä¸»è¦ç”¨äºé¿å…åœ¨åŒä¸€æ¬¡è¯·æ±‚ä¸­å¯¹ç›¸åŒçš„æ•°æ®å‘èµ·é‡å¤çš„ç½‘ç»œè¯·æ±‚ã€‚
  - ä¸€æ—¦è¯·æ±‚å®Œæˆï¼Œè®°å¿†çš„ç»“æœå°†è¢«é‡Šæ”¾ï¼Œä¸ä¼šåœ¨å…¶ä»–è¯·æ±‚ä¹‹é—´å…±äº«ã€‚

ç®€å•æ¥è¯´ï¼Œ**æ•°æ®ç¼“å­˜é€‚ç”¨äºè·¨è¯·æ±‚å¤ç”¨çš„æ•°æ®**ï¼Œè€Œ**è¯·æ±‚è®°å¿†ä»…é™äºå½“å‰è¯·æ±‚ä¸­çš„é‡å¤ä¼˜åŒ–**ã€‚

### é‡æ–°éªŒè¯

é‡æ–°éªŒè¯çš„å®šä¹‰ï¼š**æ¸…é™¤ç¼“å­˜æ•°æ®ï¼Œç„¶åé‡æ–°è·å–æœ€æ–°çš„æ•°æ®ã€‚** è€Œ Next.js ä¸­æä¾›äº†ä¸¤ç§æ–¹å¼å®Œæˆé‡æ–°éªŒè¯ï¼š

1. **åŸºäºæ—¶é—´çš„é‡æ–°éªŒè¯**ï¼šæ ¹æ®æŒ‡å®šçš„æ—¶é—´ï¼Œè‡ªåŠ¨è¿›è¡Œé‡æ–°éªŒè¯ã€‚è¿™å¯¹äºä¸ç»å¸¸æ›´æ”¹ä¸”æ–°é²œåº¦ä¸é‚£ä¹ˆé‡è¦çš„æ•°æ®å¾ˆæœ‰ç”¨ã€‚
2. **æŒ‰éœ€é‡æ–°éªŒè¯**ï¼šæ ¹æ®äº‹ä»¶ï¼ˆä¾‹å¦‚è¡¨å•æäº¤ï¼‰é‡æ–°éªŒè¯æ•°æ®ã€‚æŒ‰éœ€é‡æ–°éªŒè¯å¯ä»¥ä½¿ç”¨åŸºäºæ ‡ç­¾æˆ–åŸºäºè·¯å¾„çš„æ–¹æ³•ç«‹å³é‡æ–°éªŒè¯æ•°æ®ç»„ã€‚å½“æ‚¨æƒ³è¦ç¡®ä¿å°½å¿«æ˜¾ç¤ºæœ€æ–°æ•°æ®æ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨ã€‚

**1ï¸âƒ£ åŸºäºæ—¶é—´çš„é‡æ–°éªŒè¯**

è¦å®šæœŸé‡æ–°éªŒè¯æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ fetch çš„ next.revalidate é€‰é¡¹æ¥è®¾ç½®èµ„æºçš„ç¼“å­˜ç”Ÿå‘½å‘¨æœŸï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚

```ts
fetch('https://api/example', { next: { revalidate: 10 } })
```

æˆ–è€…åœ¨è·¯ç”±æ®µé…ç½®é¡¹ä¸­è¿›è¡Œé…ç½®ï¼Œå¯ä»¥åœ¨é¡µé¢ä¸Šæˆ–è€…è·¯ç”±å¤„ç†ç¨‹åºä¸­å¢åŠ ä»¥ä¸‹å±æ€§çš„å¯¼å‡ºï¼š

```ts
// layout.tsx | page.tsx | route.ts
export const revalidate = 10
```

**2ï¸âƒ£ æŒ‰éœ€é‡æ–°éªŒè¯**

æ•°æ®å¯ä»¥æ ¹æ®è·¯å¾„ (**`revalidatePath`**) æˆ–ç¼“å­˜æ ‡è®° (**`revalidateTag`**) æŒ‰éœ€é‡æ–°éªŒè¯ã€‚

### é€‰æ‹©é€€å‡º

å¦‚æœæ‚¨ä¸æƒ³ç¼“å­˜ fetch çš„å“åº”ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

```tsx
const data = await fetch('https://api.vercel.app/blog', { cache: 'no-store' })
```

# æ ·å¼

@See https://nextjs.org/docs/app/building-your-application/styling

æ¨èä½¿ç”¨ [tailwindscss](https://tailwindcss.com/) + [clsx](https://www.npmjs.com/package/clsx) 

1. Tailwind æ˜¯ä¸€ä¸ª CSS æ¡†æ¶ï¼Œå…è®¸æ‚¨ç›´æ¥åœ¨ TSX æ ‡è®°ä¸­å¿«é€Ÿç¼–å†™å®ç”¨ç¨‹åºç±» ï¼Œä»è€ŒåŠ å¿«å¼€å‘è¿‡ç¨‹ã€‚
2. clsx æ˜¯ä¸€ä¸ªå¯è®©æ‚¨è½»æ¾åˆ‡æ¢ç±»åç§°çš„åº“ã€‚

åœ¨ Tailwind é…ç½®æ–‡ä»¶ä¸­ï¼Œæ·»åŠ å°†ä½¿ç”¨ Tailwind ç±»åçš„æ–‡ä»¶çš„è·¯å¾„ï¼Œå‚è€ƒ [è¿™é‡Œ >> ](https://nextjs.org/docs/app/building-your-application/styling/tailwind-css#configuring-tailwind)

# ä¼˜åŒ–

## å›ºå®šå®½é«˜æ¯”

```tsx
<div className="aspect-[16/9] bg-gray-200"></div>
```

ä¸Šé¢çš„å†™æ³•ç­‰ä»·äºï¼š

```tsx
<div className="bg-gray-200" style={{aspectRatio: '16/9'}}></div>
```

å®é™…å¼€å‘ä¸­ï¼Œä½ å¯ä»¥æ ¹æ®è®¾è®¡ç¨¿å°ºå¯¸æ¥è®¾ç½®ï¼Œæ¯”å¦‚é»˜è®¤å°ºå¯¸æ˜¯ï¼š`1920x560`ï¼Œå¯ä»¥è¿™æ ·è®¾ç½®ï¼š

```tsx
<div className="aspect-[1920/560] bg-gary-200"></div>
```

å›¾ç‰‡å¡«å……

```tsx
<div className="aspect-[1920/560] relative">
  <Image fill src={"/images/xxx.png"} alt="banner_Image" />
</div>
```

> æ¸©é¦¨æç¤ºï¼šéœ€è¦åœ¨å®¹å™¨ä¸Šæ·»åŠ  `relative` å›¾ç‰‡æ‰èƒ½æ­£å¸¸æ˜¾ç¤ºã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè®¾ç½®å®½é«˜æ¯”å¹¶ä¸æ˜¯åœ¨è®¾ç½®å…ƒç´ å°ºå¯¸ï¼Œä½ è¿˜åº”è¯¥è®¾ç½®å®¹å™¨çš„å®½åº¦ï¼ˆæˆ–è€…é«˜åº¦ï¼‰ï¼Œå»ºè®¾å®½é«˜æ¯”æ˜¯ 200/100ï¼ˆæˆ–è€… 2/1ï¼‰ï¼Œå®¹å™¨å®½åº¦ä¸º 20%ï¼Œåˆ™å¯ä»¥è¿™æ ·è®¾ç½®ï¼š

```tsx
<div className="aspect-[200/100] bg-gray-200 w-[20%] mx-auto"></div>
```

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ¯”å¦‚å›¾æ–‡æ··æ’ï¼Œå·¦ä¾§å›¾ç‰‡å³ä¾§æ–‡å­—è¿™ç§ï¼Œé€šå¸¸å®¹å™¨è®¾ç½®ä¸º flex å¸ƒå±€ï¼Œæ­¤æ—¶å¦‚æœæ–‡æœ¬é«˜åº¦é«˜äºå›¾ç‰‡é«˜åº¦ï¼Œé‚£ä¹ˆä½ è®¾ç½®çš„å®½é«˜æ¯”å°†ä¸ä¼šç”Ÿæ•ˆï¼Œå› ä¸ºå›¾ç‰‡ä¼šè¢«é»˜è®¤æ‹‰ä¼¸æˆåŒæ–‡æœ¬é«˜åº¦ä¸€è‡´ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```tsx
<div className="container mx-auto flex">
  <div className="aspect-[200/100] bg-gray-200 shrink-0 mr-8 rounded-md w-[30%]"></div>
  <div className="flex-1">
    <p>æ–°åç¤¾åŒ—äº¬12æœˆ9æ—¥ç”µâ€‚ä¸­å…±ä¸­å¤®æ”¿æ²»å±€12æœˆ9æ—¥å¬å¼€ä¼šè®®ï¼Œåˆ†æç ”ç©¶2025å¹´ç»æµå·¥ä½œï¼›å¬å–ä¸­å¤®çºªå§”å›½å®¶ç›‘å§”å·¥ä½œæ±‡æŠ¥ï¼Œç ”ç©¶éƒ¨ç½²2025å¹´å…šé£å»‰æ”¿å»ºè®¾å’Œåè…è´¥å·¥ä½œã€‚ä¸­å…±ä¸­å¤®æ€»ä¹¦è®°ä¹ è¿‘å¹³ä¸»æŒä¼šè®®ã€‚</p>
    <p>
      ä¼šè®®å¼ºè°ƒï¼Œåšå¥½æ˜å¹´ç»æµå·¥ä½œï¼Œè¦ä»¥ä¹ è¿‘å¹³æ–°æ—¶ä»£ä¸­å›½ç‰¹è‰²ç¤¾ä¼šä¸»ä¹‰æ€æƒ³ä¸ºæŒ‡å¯¼ï¼Œå…¨é¢è´¯å½»è½å®å…šçš„äºŒåå¤§å’ŒäºŒåå±ŠäºŒä¸­ã€ä¸‰ä¸­å…¨ä¼šç²¾ç¥ï¼ŒåšæŒç¨³ä¸­æ±‚è¿›å·¥ä½œæ€»åŸºè°ƒï¼Œå®Œæ•´å‡†ç¡®å…¨é¢è´¯å½»æ–°å‘å±•ç†å¿µï¼ŒåŠ å¿«æ„å»ºæ–°å‘å±•æ ¼å±€ï¼Œæ‰å®æ¨åŠ¨é«˜è´¨é‡å‘å±•ï¼Œè¿›ä¸€æ­¥å…¨é¢æ·±åŒ–æ”¹é©ï¼Œæ‰©å¤§é«˜æ°´å¹³å¯¹å¤–å¼€æ”¾ï¼Œå»ºè®¾ç°ä»£åŒ–äº§ä¸šä½“ç³»ï¼Œæ›´å¥½ç»Ÿç­¹å‘å±•å’Œå®‰å…¨ï¼Œå®æ–½æ›´åŠ ç§¯ææœ‰ä¸ºçš„å®è§‚æ”¿ç­–ï¼Œæ‰©å¤§å›½å†…éœ€æ±‚ï¼Œæ¨åŠ¨ç§‘æŠ€åˆ›æ–°å’Œäº§ä¸šåˆ›æ–°èåˆå‘å±•ï¼Œç¨³ä½æ¥¼å¸‚è‚¡å¸‚ï¼Œé˜²èŒƒåŒ–è§£é‡ç‚¹é¢†åŸŸé£é™©å’Œå¤–éƒ¨å†²å‡»ï¼Œç¨³å®šé¢„æœŸã€æ¿€å‘æ´»åŠ›ï¼Œæ¨åŠ¨ç»æµæŒç»­å›å‡å‘å¥½ï¼Œä¸æ–­æé«˜äººæ°‘ç”Ÿæ´»æ°´å¹³ï¼Œä¿æŒç¤¾ä¼šå’Œè°ç¨³å®šï¼Œé«˜è´¨é‡å®Œæˆâ€œåå››äº”â€è§„åˆ’ç›®æ ‡ä»»åŠ¡ï¼Œä¸ºå®ç°â€œåäº”äº”â€è‰¯å¥½å¼€å±€æ‰“ç‰¢åŸºç¡€ã€‚
    </p>
  </div>
</div>
```

æ¸²æŸ“ç»“æœï¼š

![](./imgs/nextjs_aspect_1.jpg)

æ­¤æ—¶ä½ å¯ä»¥å†å¥—ä¸€å±‚å®¹å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```tsx
<div className="container mx-auto flex">
  <div className="w-[30%]">
    <div className="aspect-[200/100] bg-gray-200 shrink-0 mr-8 rounded-md"></div>
  </div>
  <div className="flex-1">
    <p>æ–°åç¤¾åŒ—äº¬12æœˆ9æ—¥ç”µâ€‚ä¸­å…±ä¸­å¤®æ”¿æ²»å±€12æœˆ9æ—¥å¬å¼€ä¼šè®®ï¼Œåˆ†æç ”ç©¶2025å¹´ç»æµå·¥ä½œï¼›å¬å–ä¸­å¤®çºªå§”å›½å®¶ç›‘å§”å·¥ä½œæ±‡æŠ¥ï¼Œç ”ç©¶éƒ¨ç½²2025å¹´å…šé£å»‰æ”¿å»ºè®¾å’Œåè…è´¥å·¥ä½œã€‚ä¸­å…±ä¸­å¤®æ€»ä¹¦è®°ä¹ è¿‘å¹³ä¸»æŒä¼šè®®ã€‚</p>
    <p>
      ä¼šè®®å¼ºè°ƒï¼Œåšå¥½æ˜å¹´ç»æµå·¥ä½œï¼Œè¦ä»¥ä¹ è¿‘å¹³æ–°æ—¶ä»£ä¸­å›½ç‰¹è‰²ç¤¾ä¼šä¸»ä¹‰æ€æƒ³ä¸ºæŒ‡å¯¼ï¼Œå…¨é¢è´¯å½»è½å®å…šçš„äºŒåå¤§å’ŒäºŒåå±ŠäºŒä¸­ã€ä¸‰ä¸­å…¨ä¼šç²¾ç¥ï¼ŒåšæŒç¨³ä¸­æ±‚è¿›å·¥ä½œæ€»åŸºè°ƒï¼Œå®Œæ•´å‡†ç¡®å…¨é¢è´¯å½»æ–°å‘å±•ç†å¿µï¼ŒåŠ å¿«æ„å»ºæ–°å‘å±•æ ¼å±€ï¼Œæ‰å®æ¨åŠ¨é«˜è´¨é‡å‘å±•ï¼Œè¿›ä¸€æ­¥å…¨é¢æ·±åŒ–æ”¹é©ï¼Œæ‰©å¤§é«˜æ°´å¹³å¯¹å¤–å¼€æ”¾ï¼Œå»ºè®¾ç°ä»£åŒ–äº§ä¸šä½“ç³»ï¼Œæ›´å¥½ç»Ÿç­¹å‘å±•å’Œå®‰å…¨ï¼Œå®æ–½æ›´åŠ ç§¯ææœ‰ä¸ºçš„å®è§‚æ”¿ç­–ï¼Œæ‰©å¤§å›½å†…éœ€æ±‚ï¼Œæ¨åŠ¨ç§‘æŠ€åˆ›æ–°å’Œäº§ä¸šåˆ›æ–°èåˆå‘å±•ï¼Œç¨³ä½æ¥¼å¸‚è‚¡å¸‚ï¼Œé˜²èŒƒåŒ–è§£é‡ç‚¹é¢†åŸŸé£é™©å’Œå¤–éƒ¨å†²å‡»ï¼Œç¨³å®šé¢„æœŸã€æ¿€å‘æ´»åŠ›ï¼Œæ¨åŠ¨ç»æµæŒç»­å›å‡å‘å¥½ï¼Œä¸æ–­æé«˜äººæ°‘ç”Ÿæ´»æ°´å¹³ï¼Œä¿æŒç¤¾ä¼šå’Œè°ç¨³å®šï¼Œé«˜è´¨é‡å®Œæˆâ€œåå››äº”â€è§„åˆ’ç›®æ ‡ä»»åŠ¡ï¼Œä¸ºå®ç°â€œåäº”äº”â€è‰¯å¥½å¼€å±€æ‰“ç‰¢åŸºç¡€ã€‚
    </p>
  </div>
</div>
```

æ¸²æŸ“ç»“æœï¼š

![](./imgs/nextjs_aspect_2.jpg)

## å›¾ç‰‡

@See https://nextjs.org/docs/app/building-your-application/optimizing/image

@See https://nextjs.org/docs/app/api-reference/components/image

## å­—ä½“

@See https://nextjs.org/docs/app/building-your-application/optimizing/fonts

## å…ƒæ•°æ®

@See https://nextjs.org/docs/app/building-your-application/optimizing/metadata

## é™æ€èµ„æº

@See https://nextjs.org/docs/app/building-your-application/optimizing/static-assets

# é…ç½®

## ç¯å¢ƒå˜é‡

@See https://nextjs.org/docs/app/building-your-application/configuring/environment-variables

Next.js å†…ç½®äº†å¯¹ç¯å¢ƒå˜é‡çš„æ”¯æŒï¼Œå› ä¸º Next.js æ˜¯ä¸€ä¸ªå…¨æ ˆæ¡†æ¶ï¼Œæ‰€ä»¥å°±åŒºåˆ†äº†æœåŠ¡ç«¯ç¯å¢ƒå˜é‡å’Œå®¢æˆ·ç«¯ç¯å¢ƒå˜é‡ï¼›ä½¿ç”¨ç¯å¢ƒå˜é‡æœ‰ä¸¤ç§æ–¹å¼ï¼š

1. é€šè¿‡ `.env` é—®è§åŠ è½½ç¯å¢ƒå˜é‡
2. é€šè¿‡ä½¿ç”¨ `NEXT_PUBLIC_` å‰ç¼€æ¥æ†ç»‘æµè§ˆå™¨çš„ç¯å¢ƒå˜é‡

### .env æ–‡ä»¶ä¸­åŠ è½½ç¯å¢ƒå˜é‡

Next.js å†…ç½®æ”¯æŒä» `.env` æ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡åˆ° `process.env` ä¸­çš„è¿™ä¸ªè¿‡ç¨‹ã€‚æˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å»ºç«‹ä¸€ä¸ª `.env` æ–‡ä»¶ï¼ˆæ³¨æ„æ˜¯æ ¹ç›®å½•ï¼Œä¸æ˜¯ `/src` ç›®å½•ï¼‰

```ini
DB_HOST=localhost
DB_USER=admin
DB_PASS=123456
```

ç°åœ¨å°±å¯ä»¥åœ¨æœåŠ¡ç«¯ç»„ä»¶æˆ–è€…è·¯ç”±å¤„ç†ç¨‹åºä¸­é€šè¿‡ `process.env` è·å–åˆ°è¯¥å€¼ï¼š

**è·¯ç”±å¤„ç†ç¨‹åº**

```ts
import { NextResponse } from "next/server";

export async function GET() {
  const dbConfig = {
    host: process.env.DB_HOST,
    username: process.env.DB_USER,
    password: process.env.DB_PASS,
  }
  console.log('DB_CONFIG >>> ', dbConfig);
  return NextResponse.json({ status: 'ok' });
}
```

åœ¨æµè§ˆå™¨ä¸­è¯·æ±‚ `http://localhost:3000/api` åï¼Œé¡µé¢å±•ç¤ºå†…å®¹å¦‚ä¸‹ï¼š

```
{
    "status": "ok"
}
```

è¯·æ±‚åå°±èƒ½çœ‹åˆ°ç»ˆç«¯æ‰“å°çš„ç¯å¢ƒå˜é‡çš„ç»“æœï¼š

```shell
 âœ“ Compiled /api in 83ms (318 modules)
DB_CONFIG >>>  { host: 'localhost', username: 'admin', password: '123456' }
```

**æœåŠ¡ç«¯ç»„ä»¶**

è¿™é‡Œå°±ç›´æ¥åœ¨ `/app` ç›®å½•ä¸‹çš„ `page.tsx` ä¸­æ¥æ¼”ç¤ºï¼Œä»£ç å¦‚ä¸‹

```tsx
console.log("process.env.DB_HOST", process.env.DB_HOST);
console.log("process.env.DB_USER", process.env.DB_USER);
console.log("process.env.DB_PASS", process.env.DB_PASS);
```

åœ¨æµè§ˆå™¨è®¿é—® `http://localhost:3000/` åï¼Œç»ˆç«¯æ‰“å°æ•ˆæœå¦‚ä¸‹ï¼š

```shell
process.env.DB_HOST localhost
process.env.DB_USER admin
process.env.DB_PASS 123456
```

> æç¤ºï¼šå¦‚æœ `.env` æ–‡ä»¶ä¸è¶³ä»¥æ»¡è¶³ä½ çš„è¦æ±‚ï¼ŒNext.js ä¸ºäº†å…¼å®¹å…¶å„åœºæ™¯çš„çµæ´»æ€§ï¼Œæä¾›äº† @next/env åŒ…æ¥æ‰©å±•ï¼

### æµè§ˆå™¨ä¸­è·å–ç¯å¢ƒå˜é‡

Next.js æ˜¯ä¸€ä¸ªå…¨æ ˆæ¡†æ¶ï¼Œè‡ªç„¶ä¹Ÿè€ƒè™‘åˆ°äº†æµè§ˆå™¨ç¯å¢ƒçš„æ—¶å€™å¦‚ä½•è·å–ç¯å¢ƒå˜é‡ï¼Œä¹Ÿæ²¡æœ‰è¿‡å¤šçš„æ–‡ä»¶é…ç½®ï¼Œå°±æ˜¯ä½¿ç”¨ `NEXT_PUBLIC_` ä¸ºå‰ç¼€çš„ç¯å¢ƒå˜é‡å°±æ˜¯æµè§ˆå™¨ç¯å¢ƒä¸­å¯ä»¥ä½¿ç”¨çš„ã€‚

> ä¸ºä»€ä¹ˆè¦åŠ å‰ç¼€å‘¢ï¼Ÿ
>
> å› ä¸º Next.js ä¸ºäº†è®©æµè§ˆå™¨å¯ä»¥è·å–ç¯å¢ƒå˜é‡ä¸­çš„å€¼ï¼Œåœ¨æ„å»ºçš„æ—¶å€™ï¼Œå°†å€¼å†…è”åˆ°å®¢æˆ·ç«¯çš„ js bundle ä¸­ï¼Œæ›¿æ¢æ‰æ‰€æœ‰ç¡¬ç¼–ç ä½¿ç”¨ `process.env.[variable]` çš„åœ°æ–¹ã€‚

å®æ“ä¸€ä¸‹ï¼šåœ¨ `.env` æ–‡ä»¶ä¸­æ·»åŠ  `NEXT_PUBLIC_PLATFORM=PC` ç„¶ååœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­ä½¿ç”¨ï¼Œå®¢æˆ·ç«¯ä»£ç å¦‚ä¸‹ï¼š

*`src/ui/Client.tsx`*

```tsx
"use client";
export default function Client() {
  console.log("NEXT_PUBLIC_PLATFORMï¼š", process.env.NEXT_PUBLIC_PLATFORM);
  return <div>This is Client Component</div>;
}
```

æ¥ä¸‹æ¥ï¼Œè¯·æŒ‰å¦‚ä¸‹æ­¥éª¤æ“ä½œï¼š

1. åœ¨ `/app/page.tsx` ä¸­å¼•å…¥ `<Client />` ç»„ä»¶
2. æ¥ç€åœ¨ç»ˆç«¯è¿è¡Œ `pnpm build` æ„å»ºé¡¹ç›®
3. æ„å»ºå®Œæˆä¹‹åä½¿ç”¨å‘½ä»¤ `pnpm start` å¯åŠ¨æ„å»ºåçš„äº§ç‰©

å¯åŠ¨ä¹‹åï¼Œåœ¨ç»ˆç«¯æŸ¥çœ‹è®¿é—®é“¾æ¥ï¼Œå¤åˆ¶ç²˜è´´åˆ°æµè§ˆå™¨ä¸­ï¼Œçœ‹çœ‹æ˜¯å¦æ‰“å°äº†æˆ‘ä»¬æƒ³è¦çš„ç¯å¢ƒå˜é‡ï¼š

```shell
NEXT_PUBLIC_PLATFORMï¼š PC
```

å¯è§ï¼Œæ˜¯æ‰“å°äº†çš„ï¼Œä½†æ˜¯è¦æ³¨æ„ï¼**åŠ¨æ€æŸ¥æ‰¾çš„å€¼æ˜¯ä¸ä¼šè¢«å†…è”**ï¼Œæ¯”å¦‚ï¼š

```tsx
// ä½¿ç”¨äº†å˜é‡ï¼Œä¸ä¼šè¢«å†…è”ï¼Œä¸ä¼šç”Ÿæ•ˆ
const key = "NEXT_PUBLIC_PLATFORM";
const val = process.env[key];

// ä½¿ç”¨äº†å˜é‡ï¼Œä¸ä¼šè¢«å†…è”ï¼Œä¸ä¼šç”Ÿæ•ˆ
const env = process.env;
const val = env.NEXT_PUBLIC_PLATFORM;
```

### é»˜è®¤ç¯å¢ƒå˜é‡

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ä¸€ä¸ª `.env` æ–‡ä»¶å°±å¤Ÿç”¨äº†ã€‚ä½†æœ‰æ—¶å€™ä½ å¯èƒ½è¿˜éœ€è¦é’ˆå¯¹ä¸åŒçš„ç¯å¢ƒå»åŠ è½½ä¸åŒçš„é…ç½®ï¼Œæ¯”å¦‚ï¼šå¼€å‘ç¯å¢ƒï¼ˆ`.env.development`ï¼‰ã€ç”Ÿäº§ç¯å¢ƒï¼ˆ`.env.production`ï¼‰ã€æ‰€æœ‰ç¯å¢ƒï¼ˆ`.env`ï¼‰ã€‚

å¦‚æœå‡æœªåœ¨ `.env` ç›¸å…³æ–‡ä»¶ä¸­é…ç½®ç¯å¢ƒå˜é‡ï¼Œå½“æ‰§è¡Œ `next dev` çš„æ—¶å€™ï¼ŒNext.js ä¼šè‡ªåŠ¨ç»™ `NODE_DEV` èµ‹å€¼ `development`ï¼Œå…¶ä»–å‘½ä»¤åˆ™ä¼šèµ‹å€¼ `production`ã€‚

> æç¤ºï¼šéœ€è¦æ³¨æ„çš„æ˜¯ NODE_ENV çš„å€¼ï¼šåªå…è®¸å€¼ä¸º `production`ã€`development` å’Œ `test`ã€‚

åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ä¸€å®šè¦è°¨æ… `.env` çš„ç›¸å…³æ–‡ä»¶ï¼Œå°½å¯èƒ½å°† `.env` ç›¸å…³æ–‡ä»¶æ·»åŠ åˆ° `.gitignore` æ–‡ä»¶ä¸­ï¼Œå› ä¸ºè¿™äº›éƒ½æ˜¯æœºå¯†ä¿¡æ¯ã€‚

### æµ‹è¯•ç¯å¢ƒçš„ç¯å¢ƒå˜é‡

æœ‰äº†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒå¤–ï¼ŒNext.jsè¿˜ç¬¬ä¸‰ä¸ªé€‰é¡¹â€”â€”**æµ‹è¯•ç¯å¢ƒ**ï¼›æµ‹è¯•ç¯å¢ƒç”¨äºåœ¨ä½¿ç”¨æµ‹è¯•å·¥å…·å¦‚ Jest æˆ– Cypress æ—¶ï¼Œè®¾ç½®ç‰¹å®šçš„ç¯å¢ƒå˜é‡ã€‚è¦é…ç½®æµ‹è¯•ç¯å¢ƒï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªåä¸º `.env.test` çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸­çš„å€¼å°†åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæµ‹è¯•ç¯å¢ƒä¸ä¼šåŠ è½½ `.env.local` ä¸­çš„å€¼ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿æ¯ä¸ªäººéƒ½èƒ½äº§ç”Ÿç›¸åŒçš„æµ‹è¯•ç»“æœã€‚è¿™äº›é»˜è®¤å€¼å°†åœ¨ `NODE_ENV` è®¾ç½®ä¸º `test` æ—¶ä½¿ç”¨ã€‚

### ç¯å¢ƒå˜é‡åŠ è½½é¡ºåº

æŒ‰é¡ºåºåœ¨ä»¥ä¸‹ä½ç½®æŸ¥æ‰¾ç¯å¢ƒå˜é‡ï¼Œä¸€æ—¦æ‰¾åˆ°å˜é‡å°±åœæ­¢ã€‚

- `process.env`
- `.env.$(NODE_ENV).local`
- `.env.local`ï¼ˆå½“ `NODE_ENV` æ˜¯ `test` çš„æ—¶å€™ä¸ä¼šæŸ¥æ‰¾ï¼‰
- `.env.$(NODE_ENV)`
- `.env`

ä¸¾ä¸ªä¾‹å­æ¥è¾…åŠ©ç†è§£ï¼Œå¦‚æœä½ åœ¨ `.env.development.local` å’Œ `.env` ä¸­è®¾ç½®äº† `NODE_ENV` ä¸º `development`ï¼ŒæŒ‰ç…§è¿™ä¸ªé¡ºåºï¼Œæœ€ç»ˆä¼šä½¿ç”¨ `.env.development.local` ä¸­çš„å€¼ã€‚

## ç«¯å£

@See https://nextjs.org/docs/app/api-reference/cli/next

æŒ‡å®šç«¯å£å’Œhostname

```shell
next dev --port=6969 --hostname=172.20.51.212
```

# æ‰©å±•

## ç”Ÿæˆå¯†é’¥

```shell
openssl rand -base64 32
```

## ä½¿ç”¨Swiperè½®æ’­ç»„ä»¶

@See https://www.swiperjs.net/

> æç¤ºï¼šåœ¨ nextjs ä¸­ä½¿ç”¨ Swiperï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„å°±æ˜¯ä¸€å®šè¦æ·»åŠ  `use client`  ä½œä¸ºå®¢æˆ·ç«¯ç»„ä»¶ä½¿ç”¨ã€‚

















